df1 = get_elig(arm1, "analysis")
df3 = get_elig(arm3, "analysis")
df1us = get_us(df1, 1)
df3us = get_us(df3, 3)
df2us = get_us(df2, 2)
df4us = get_us(df4, 4)
df2us_ga = df2us %>% filter(ga_at_us >= 6 & ga_at_us <= 22)
df4us_ga = df4us %>% filter(ga_at_us >= 6 & ga_at_us <= 22)
df1_ga = df1us %>% filter(back_calc_dod_ga_recorded >= 6 & back_calc_dod_ga_recorded <= 22)
df3_ga = df3us %>% filter(back_calc_dod_ga_recorded >= 6 & back_calc_dod_ga_recorded <= 22)
train = make_data(df2us_ga, df4us_ga, "binomial", wk_thresh = 22, 2)
summary(train$ga_at_us)
train$Arm = ifelse(train$dhc %in% A2, "US_stANC", "US_gANC")
table(train$Arm)
usethis::browse_github_pat()
usethis::edit_r_environ()
library(knitr)
library(here)
library(dplyr)
library(geepack)
library(parsedate)
library(ggplot2)
devtools::install_github("tlverse/tmle3shift", dependencies = T)
devtools::install_github('nhejazi/haldensify')
devtools::install_github("tlverse/tmle3", dependencies = T)
devtools::install_github("tlverse/sl3", dependencies = T)
df = read.csv(here('data', 'ARMS1_2__3Corrected_4FinalAnalysisV4ConsentedLabelledRecodedOutliersMATERNALFACILITY24Sep2019WMatWtFU.csv'))
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
library(knitr)
library(here)
library(dplyr)
library(geepack)
library(parsedate)
library(ggplot2)
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
df[df == "#NULL!" | df == " " | df == ""] <- NA
id_arm = read.csv(here('data', 'RW_Study_ID.csv'))
table(df$ubudehe_cat)
library(knitr)
library(here)
df = read.csv(here('data', 'ARMS1_2__3Corrected_4FinalAnalysisV4ConsentedLabelledRecodedOutliersMATERNALFACILITY24Sep2019WMatWtFU.csv'))
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
df[df == "#NULL!" | df == " " | df == ""] <- NA
id_arm = read.csv(here('data', 'RW_Study_ID.csv'))
A1 = c(333, 436, 544, 120, 110, 545, 111, 224, 221)
A2 = c(435, 331, 541, 115, 113, 539, 226, 329, 332)
A3 = c(330, 438, 540, 117, 116, 542, 112, 328, 223)
A4 = c(437, 327, 543, 114, 119, 334, 118, 222, 225)
arm1 = df %>% filter(dhc %in% A1)
arm2 = df %>% filter(dhc %in% A2)
arm3 = df %>% filter(dhc %in% A3)
arm4 = df %>% filter(dhc %in% A4)
risk_factors = x %>% select(obhx_preterm, obhx_lbw, obhx_abortion, obhx_sb, obhx_28d_death)
library(dplyr)
x  = arm1
risk_factors = x %>% select(obhx_preterm, obhx_lbw, obhx_abortion, obhx_sb, obhx_28d_death)
summary(risk_factors)
dim(x)
summary(x$hx_ptdlvry)
summary(x$obhx_abortion)
table(x$obhx_abortion)
table(x$obhx_preterm, x$hx_ptdlvry)
table(x$hx_ptdlvry)
table(x$obhx_preterm)
table(is.na(x$obhx_preterm))
summary(x$enroll_obhx___1)
library(knitr)
library(here)
library(dplyr)
library(geepack)
library(parsedate)
source(here('code', "rw_consort_functions.R"))
source(here('code', "ga_pred", "functions.R"))
df = read.csv(here('data', 'ARMS1_2__3Corrected_4FinalAnalysisV4ConsentedLabelledRecodedOutliersMATERNALFACILITY18Sep2019.csv'))
df = read.csv(here('data', 'ARMS1_2__3Corrected_4FinalAnalysisV4ConsentedLabelledRecodedOutliersMATERNALFACILITY24Sep2019WMatWtFU.csv'))
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
df[df == "#NULL!" | df == " " | df == ""] <- NA
id_arm = read.csv(here('data', 'RW_Study_ID.csv'))
sum(is.na(df$us_date))
sum(is.na(df$us_adjga))
A1 = c(333, 436, 544, 120, 110, 545, 111, 224, 221)
A2 = c(435, 331, 541, 115, 113, 539, 226, 329, 332)
A3 = c(330, 438, 540, 117, 116, 542, 112, 328, 223)
A4 = c(437, 327, 543, 114, 119, 334, 118, 222, 225)
df1_elig = get_elig(arm1, "elig_enroll")
df2_elig = get_elig(arm2, "elig_enroll")
arm1 = df %>% filter(dhc %in% A1 | dhc %in% A2)
arm2 = df %>% filter(dhc %in% A3 | dhc %in% A4)
df1_elig = get_elig(arm1, "elig_enroll")
df2_elig = get_elig(arm2, "elig_enroll")
sanc_elig = get_anc_covg(df1_elig)
ganc_elig = get_anc_covg(df2_elig)
x = df2_elig
dim(x)
n_anc = sum(!is.na(x$NumberANCs))
n_anc1ga = sum(!is.na(x$anc1ga_anc))
n_anc = sum(!is.na(x$NumberANCs))
n_anc1date = sum(!is.na(x$anc1date_anc))
ga_lt_16 = c(table(x$anc1ga_anc < 16, useNA = "always"), n_anc1ga)
mean_anc = c(mean(x$NumberANCs), sd(x$NumberANCs), sum(is.na(x$NumberANCs)), n_anc)
gt_4_anc = c(table(x$NumberANCs >= 4, useNA = "always"), n_anc)
gt_2_anc = c(table(x$NumberANCs >= 2, useNA = "always"), n_anc1date)
returned_2_anc_date = c(table(!is.na(x$date_ancfuvst_2), useNA = "always"), n_anc1date)
out = data.frame(rbind(ga_lt_16, gt_4_anc, gt_2_anc, returned_2_anc_date, mean_anc))
ga_lt_16
gt_4_anc
gt_2_anc
returned_2_anc_date
mean_anc
source('~/Documents/PTBi/rwanda/rw_primary_analysis/code/rw_consort_functions.R')
df1_elig = get_elig(arm1, "elig_enroll")
df2_elig = get_elig(arm2, "elig_enroll")
sanc_elig = get_anc_covg(df1_elig)
ganc_elig = get_anc_covg(df2_elig)
sanc_elig
here()
library(knitr)
library(here)
library(dplyr)
library(geepack)
library(parsedate)
library(ggplot2)
opts_chunk$set(fig.width=12, fig.height=4, fig.path='RnwFigs/',
warning=FALSE, message=FALSE, tidy=FALSE)
options(width=60)
set.seed(53079239)
if(!require("qtl")) install.packages("qtl", repos="http://cran.us.r-project.org")
df = read.csv(here('data', 'ARMS1_2__3Corrected_4FinalAnalysisV4ConsentedLabelledRecodedOutliersMATERNALFACILITY24Sep2019WMatWtFU.csv'))
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
df[df == "#NULL!" | df == " " | df == ""] <- NA
id_arm = read.csv(here('data', 'RW_Study_ID.csv'))
source(here('code', "rw_consort_functions.R"))
source(here('code', "ga_pred", "functions.R"))
A1 = c(333, 436, 544, 120, 110, 545, 111, 224, 221)
A2 = c(435, 331, 541, 115, 113, 539, 226, 329, 332)
A3 = c(330, 438, 540, 117, 116, 542, 112, 328, 223)
A4 = c(437, 327, 543, 114, 119, 334, 118, 222, 225)
arm1 = df %>% filter(dhc %in% A1)
arm2 = df %>% filter(dhc %in% A2)
arm3 = df %>% filter(dhc %in% A3)
arm4 = df %>% filter(dhc %in% A4)
df2 = get_elig(arm2, "analysis")
df4 = get_elig(arm4, "analysis")
df1 = get_elig(arm1, "analysis")
df3 = get_elig(arm3, "analysis")
x - arm2
x = arm2
study_id = x[, sprintf('study_id_full_new')]
dhc = x$dhc
m_age_enroll = as.numeric(as.character(x[ ,'m_age']))
m_age_anc1 = as.numeric(x[ ,'m_age_anc'])
x$mother_age_cat = rep(NA, nrow(x))
x$mother_age_cat[x$mother_age >= 12 & x$mother_age < 18] = "12-17"
x$mother_age_cat[x$mother_age >= 18 & x$mother_age <= 35] = "18-35"
x$mother_age_cat[x$mother_age > 35] = "$>$ 35"
m_stature =  as.numeric(x[ , 'ht_und150'])
m_wt = as.numeric(x[ , 'wt_1stvisit'])
date_del = as.Date(x[, 'date_delivery_mat'], format= "%d-%b-%y")
date_del = as.Date(x[, 'date_delivery_mat'], format= "%m/%d/%Y")
date_anc1 = as.Date(x[, 'anc1date_anc'], format= "%d-%b-%y")
date_anc1 = as.Date(x[, 'anc1date_anc'], format = "%m/%d/%Y")
days_from_anc1_to_del = (date_del - date_anc1)
wks_from_anc1_to_del = (date_del - date_anc1)/7
lmp = as.Date(x[, sprintf('lmp_anc')], format= "%m/%d/%Y")
wks_from_lmp_to_del = (date_del - lmp) / 7
ga_at_anc1_by_lmp = (date_anc1 - lmp) / 7
ga_at_deliv_lmp = (ga_at_anc1_by_lmp) + (days_from_anc1_to_del / 7)
edd = as.Date(x[, sprintf('edd_anc')], format= "%d-%b-%y")
edd = as.Date(x[, sprintf('edd_anc')], format= "%m/%d/%Y")
ga_at_delivery_by_edd_anc1 = (280 + (date_del - edd)) / 7
ga_anc1_recorded = (x[, sprintf('anc1ga_anc')])
ga_anc1_by_edd = 40 - ((edd - date_anc1)/7)
ga_at_delivery_by_ga_anc1 = ga_anc1_recorded + (days_from_anc1_to_del / 7)
parity = as.numeric(x[, "parity_anc"])
grav = as.numeric(x[, "gravidity_anc"])
fuel = as.numeric(x[, sprintf("fuel_use")])
enough_food = as.numeric(x[, sprintf("hh_enoughfood")])
ever_no_food = as.numeric(x[, sprintf("hh_evernofood")])
run_out_food = as.numeric(x[, sprintf("hh_runoutfood")])
not_enough_food = as.numeric(x[, sprintf("hh_notenoughfood")])
smoke = as.numeric(x[, sprintf("preg_smoke")])
hh_smoker = as.numeric(x[, sprintf("hh_smoker")])
alc = as.numeric(x[, sprintf("preg_alc")])
sex = x[, 'infant_sex']
muac = as.numeric(x[, sprintf('muac_birth')])
chest_c = as.numeric(x[, sprintf('cc_birth')])
weight = as.numeric(as.character(x[, sprintf('bwt_birth')]))
weight[!is.na(weight) & (weight/10) < 1] <- (weight * 1000)[!is.na(weight) & (weight/10) < 1]
table(weight)
head_cir =  as.numeric(x[ ,sprintf('hc_birth')])
length_b =  as.numeric(x[ ,sprintf('length_birth')])
apgar1 = as.numeric(x[, sprintf('apgar_1mbirth')])
apgar5 = as.numeric(x[, sprintf('apgar_5mbirth')])
arm = 2
if (arm == 2 | arm == 4) {
#us_edd = date_cleaning(as.Date(x[, sprintf('edd_us')], format = "%Y-%m-%d"))
us_edd = as.Date(x[, sprintf('edd_us')], format= "%d-%b-%y")
us_edd = as.Date(x[, sprintf('edd_us')], format= "%m/%d/%Y")
ga_at_us = as.numeric(as.character(x[, sprintf('us_adjga')]))
us_date =  as.Date(x[, sprintf('us_date')],format= "%m/%d/%Y")
#us_date =  as.Date(x[, sprintf('us_date')],format= "%d %b %y")
#us_date[140:145]
#x[140:145, 'us_date']
ga_del_by_us_date = ga_at_us + (date_del - us_date)/7
edd_by_us_date = 7*(40 - ga_at_us) + us_date
ga_us_diff = date_del - us_edd
ga_del_by_us_edd = (280 + ga_us_diff) / 7
wks_from_lmp_to_us = (us_date - lmp)/7
wks_from_anc1_to_us = (us_date - date_anc1)/7
wks_from_us_to_del = (date_del - us_date)/7
final = data.frame(wks_from_anc1_to_us,
wks_from_lmp_to_us,
wks_from_us_to_del,
us_date,
ga_at_us, edd_by_us_date, us_edd, ga_del_by_us_date,
ga_del_by_us_edd)
} else {
ga_del_us = rep(NA, nrow(x))
ga_at_us = rep(NA, nrow(x))
us_date = rep(NA, nrow(x))
final = data.frame(ga_del_us, ga_at_us, us_date)
}
fun_ht_anc1 = as.numeric(as.character(x[, sprintf('fundalht_1stvisit')]))
ga_at_delivery_by_fh_anc1 = fun_ht_anc1 + (days_from_anc1_to_del/7)
ga_weeks_recorded = x[, sprintf('ga_weeks')]
back_calc_dod_ga_recorded = ga_weeks_recorded - wks_from_anc1_to_del
usrec = x$us_rec
risk_factors = x %>% select(obhx_preterm, obhx_lbw, obhx_abortion, obhx_sb, obhx_28d_death)
frame = data.frame(study_id, risk_factors, dhc, m_age_enroll, m_age_anc1, m_stature, m_wt, parity, grav, fuel,
enough_food, ever_no_food,
run_out_food, not_enough_food, smoke, hh_smoker, alc,
lmp, date_anc1,
usrec, ga_at_anc1_by_lmp, ga_anc1_by_edd, ga_anc1_recorded,
fun_ht_anc1, edd,
wks_from_anc1_to_del, wks_from_lmp_to_del, date_del,
ga_at_deliv_lmp, ga_at_delivery_by_ga_anc1,
ga_at_delivery_by_edd_anc1,
ga_at_delivery_by_fh_anc1,
ga_weeks_recorded,
back_calc_dod_ga_recorded,
sex, weight, head_cir, length_b, apgar1, apgar5)
head(frame)
head(risk_factors)
summary(risk_factors)
risk_factors[is.na(risk_factors)] <- 0
summary(risk_factors)
sapply(risk_factors, table)
risk_factors = x %>% select(obhx_preterm, obhx_lbw, obhx_abortion, obhx_sb, obhx_28d_death)
risk_factors[is.na(risk_factors)] <- 0
sapply(risk_factors, table)
frame = data.frame(study_id, risk_factors, dhc, m_age_enroll, m_age_anc1, m_stature, m_wt, parity, grav, fuel,
enough_food, ever_no_food,
run_out_food, not_enough_food, smoke, hh_smoker, alc,
lmp, date_anc1,
usrec, ga_at_anc1_by_lmp, ga_anc1_by_edd, ga_anc1_recorded,
fun_ht_anc1, edd,
wks_from_anc1_to_del, wks_from_lmp_to_del, date_del,
ga_at_deliv_lmp, ga_at_delivery_by_ga_anc1,
ga_at_delivery_by_edd_anc1,
ga_at_delivery_by_fh_anc1,
ga_weeks_recorded,
back_calc_dod_ga_recorded,
sex, weight, head_cir, length_b, apgar1, apgar5)
frame = data.frame(frame, final)
frame
View(frame)
dim(risk_factors)
dim(final)
source('~/Documents/PTBi/rwanda/rw_primary_analysis/code/ga_pred/functions.R')
df1us = get_us(df1, 1)
df3us = get_us(df3, 3)
df2us = get_us(df2, 2)
df4us = get_us(df4, 4)
df2us_ga = df2us %>% filter(ga_at_us >= 6 & ga_at_us <= 22)
df4us_ga = df4us %>% filter(ga_at_us >= 6 & ga_at_us <= 22)
df1_ga = df1us %>% filter(back_calc_dod_ga_recorded >= 6 & back_calc_dod_ga_recorded <= 22)
df3_ga = df3us %>% filter(back_calc_dod_ga_recorded >= 6 & back_calc_dod_ga_recorded <= 22)
train = make_data(df2us_ga, df4us_ga, "binomial", wk_thresh = 22, 2)
head(train)
summary(train$ga_at_us)
train$Arm = ifelse(train$dhc %in% A2, "US_stANC", "US_gANC")
table(train$Arm)
by_arm = split(train, train$Arm)
by_arm = lapply(by_arm, output_ptb_rate)
df2 = get_elig(arm2, "analysis")
df4 = get_elig(arm4, "analysis")
df1 = get_elig(arm1, "analysis")
df3 = get_elig(arm3, "analysis")
df1us = get_us(df1, 1)
df3us = get_us(df3, 3)
df2us = get_us(df2, 2)
df4us = get_us(df4, 4)
head(df1us)
df1us = get_us(df1, 1)
df3us = get_us(df3, 3)
df2us = get_us(df2, 2)
df4us = get_us(df4, 4)
us_2 = df2us
us_4 = df4us
dim(us_2)
arm = 2
if ( arm == 2 | arm == 4) {
us_2 = us_2[!is.na(us_2$ga_del_by_us_date) | !is.na(us_2$ga_del_by_us_edd), ]
#
us_4 = us_4[!is.na(us_4$ga_del_by_us_date) | !is.na(us_4$ga_del_by_us_edd), ]
} else if (arm == 1 | arm == 3) {
new = (rbind(us_2, us_4))
new = subset(new, select = -c(wks_from_anc1_to_us, wks_from_lmp_to_us,
wks_from_us_to_del, us_date, ga_at_us,
usrec, edd_by_us_date, us_edd, ga_del_by_us_date, ga_del_by_us_edd))
#new = new[complete.cases(new), ]
return(new)
}
names(us_4)
dim(us_2)
out2 = us_2[complete.cases(subset(us_2, select = -c(ga_weeks_recorded, study_id))),]
out4 = us_4[complete.cases(subset(us_4, select = -c(ga_weeks_recorded, study_id))),]
dim(out2)
us_2 = df2us
dim(us_2)
us_2 = us_2[!is.na(us_2$ga_del_by_us_date) | !is.na(us_2$ga_del_by_us_edd), ]
dim(us_2)
us_2 = df2us
names(us_2)
if ( arm == 2 | arm == 4) {
us_2 = us_2[!is.na(us_2$ga_del_by_us_date) | !is.na(us_2$ga_del_by_us_edd), ]
#
us_4 = us_4[!is.na(us_4$ga_del_by_us_date) | !is.na(us_4$ga_del_by_us_edd), ]
} else if (arm == 1 | arm == 3) {
new = (rbind(us_2, us_4))
new = subset(new, select = -c(wks_from_anc1_to_us, wks_from_lmp_to_us,
wks_from_us_to_del, us_date, ga_at_us,
usrec, edd_by_us_date, us_edd, ga_del_by_us_date, ga_del_by_us_edd))
#new = new[complete.cases(new), ]
return(new)
}
us_2 = df2us
us_2 = us_2[!(is.na(us_2$ga_del_by_us_date) | is.na(us_2$ga_del_by_us_edd)), ]
dim(us_2)
us_2 = us_2[!(is.na(us_2$ga_del_by_us_date) & is.na(us_2$ga_del_by_us_edd)), ]
us_2 = df2us
us_2 = us_2[!is.na(us_2$ga_del_by_us_date) | !is.na(us_2$ga_del_by_us_edd), ]
us_2 = df2us
sum(!is.na(us_2$ga_del_by_us_date))
us_2 = us_2[!is.na(us_2$ga_del_by_us_date) | !is.na(us_2$ga_del_by_us_edd), ]
us_4 = us_4[!is.na(us_4$ga_del_by_us_date) | !is.na(us_4$ga_del_by_us_edd), ]
dim(df2us)
us_4 = df4us
us_4 = us_4[!is.na(us_4$ga_del_by_us_date) | !is.na(us_4$ga_del_by_us_edd), ]
names(us_4)
summary(us_4)
df2$ubudehe_cat
summary(df2$ubudehe_cat)
source('~/Documents/PTBi/rwanda/rw_primary_analysis/code/ga_pred/functions.R')
df1us = get_us(df1, 1)
df3us = get_us(df3, 3)
df2us = get_us(df2, 2)
df4us = get_us(df4, 4)
summary(df2us)
summary(df4us)
1704/370
1704/3470
here()
df = read.csv(here('data', 'ARMS1_2__3Corrected_4FinalAnalysisV4ConsentedLabelledRecodedOutliersMATERNALFACILITY18Sep2019.csv'))
df = read.csv(here('data', 'ARMS1_2__3Corrected_4FinalAnalysisV4ConsentedLabelledRecodedOutliersMATERNALFACILITY24Sep2019WMatWtFU.csv'))
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
df[df == "#NULL!" | df == " " | df == ""] <- NA
id_arm = read.csv(here('data', 'RW_Study_ID.csv'))
sum(is.na(df$us_date))
sum(is.na(df$us_adjga))
A1 = c(333, 436, 544, 120, 110, 545, 111, 224, 221)
A2 = c(435, 331, 541, 115, 113, 539, 226, 329, 332)
A3 = c(330, 438, 540, 117, 116, 542, 112, 328, 223)
A4 = c(437, 327, 543, 114, 119, 334, 118, 222, 225)
arm1 = df %>% filter(dhc %in% A1)
arm2 = df %>% filter(dhc %in% A2)
arm3 = df %>% filter(dhc %in% A3)
arm4 = df %>% filter(dhc %in% A4)
arm1 = df %>% filter(dhc %in% A1 | dhc %in% A2)
arm2 = df %>% filter(dhc %in% A3 | dhc %in% A4)
df1_elig = get_elig(arm1, "elig_enroll")
df2_elig = get_elig(arm2, "elig_enroll")
source('~/Documents/PTBi/rwanda/rw_primary_analysis/code/rw_consort_functions.R')
df1_elig = get_elig(arm1, "elig_enroll")
df2_elig = get_elig(arm2, "elig_enroll")
sanc_elig = get_anc_covg(df1_elig)
ganc_elig = get_anc_covg(df2_elig)
sanc_elig
arm1 = df %>% filter(dhc %in% A1)
arm2 = df %>% filter(dhc %in% A2)
arm3 = df %>% filter(dhc %in% A3)
arm4 = df %>% filter(dhc %in% A4)
df1_elig = get_elig(arm1, "elig_enroll")
df2_elig = get_elig(arm2, "elig_enroll")
df3_elig = get_elig(arm1, "elig_enroll")
df4_elig = get_elig(arm2, "elig_enroll")
df4_elig
arm1 = df %>% filter(dhc %in% A1 | dhc %in% A2)
arm2 = df %>% filter(dhc %in% A3 | dhc %in% A4)
df1_elig = get_elig(arm1, "elig_enroll")
df2_elig = get_elig(arm2, "elig_enroll")
df1_elig
sanc_elig = get_anc_covg(df1_elig)
ganc_elig = get_anc_covg(df2_elig)
sanc_elig
arm1 = df %>% filter(dhc %in% A1)
arm2 = df %>% filter(dhc %in% A2)
arm3 = df %>% filter(dhc %in% A3)
arm4 = df %>% filter(dhc %in% A4)
df1_elig = get_elig(arm1, "elig_enroll")
df2_elig = get_elig(arm2, "elig_enroll")
df3_elig = get_elig(arm1, "elig_enroll")
df4_elig = get_elig(arm2, "elig_enroll")
arm1_elig = get_anc_covg(df1_elig)
arm2_elig = get_anc_covg(df2_elig)
arm3_elig = get_anc_covg(df3_elig)
arm4_elig = get_anc_covg(df4_elig)
arm1_elig
arm2_elig
2139 + 1560
library(openxlsx)
out = list(arm1_elig, arm2_elig, arm3_elig, arm4_elig)
names(out) = c("arm1", "arm2", "arm3", "arm4")
write.xlsx(out, file = sprintf("anc_covg_by_arm_eligible_%s.xlsx", Sys.Date()), row.names = T)
arm1 = df %>% filter(dhc %in% A1)
arm2 = df %>% filter(dhc %in% A2)
arm3 = df %>% filter(dhc %in% A3)
arm4 = df %>% filter(dhc %in% A4)
df1_elig = get_elig(arm1, "elig_enroll")
df2_elig = get_elig(arm2, "elig_enroll")
df3_elig = get_elig(arm3, "elig_enroll")
df4_elig = get_elig(arm4, "elig_enroll")
arm1_elig = get_anc_covg(df1_elig)
arm2_elig = get_anc_covg(df2_elig)
arm3_elig = get_anc_covg(df3_elig)
arm4_elig = get_anc_covg(df4_elig)
library(openxlsx)
out = list(arm1_elig, arm2_elig, arm3_elig, arm4_elig)
names(out) = c("arm1", "arm2", "arm3", "arm4")
write.xlsx(out, file = sprintf("anc_covg_by_arm_eligible_%s.xlsx", Sys.Date()), row.names = T)
1830+1816
here()
library(knitr)
library(here)
library(dplyr)
library(geepack)
library(parsedate)
opts_chunk$set(fig.width=12, fig.height=4, fig.path='RnwFigs/',
warning=FALSE, message=FALSE, tidy=FALSE)
options(width=60)
set.seed(53079239)
if(!require("qtl")) install.packages("qtl", repos="http://cran.us.r-project.org")
source(here('code', "rw_consort_functions.R"))
source(here('code', "ga_pred", "functions.R"))
df = read.csv(here('data', 'ARMS1_2__3Corrected_4FinalAnalysisV4ConsentedLabelledRecodedOutliersMATERNALFACILITY18Sep2019.csv'))
df = read.csv(here('data', 'ARMS1_2__3Corrected_4FinalAnalysisV4ConsentedLabelledRecodedOutliersMATERNALFACILITY24Sep2019WMatWtFU.csv'))
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
df[df == "#NULL!" | df == " " | df == ""] <- NA
id_arm = read.csv(here('data', 'RW_Study_ID.csv'))
sum(is.na(df$us_date))
sum(is.na(df$us_adjga))
A1 = c(333, 436, 544, 120, 110, 545, 111, 224, 221)
A2 = c(435, 331, 541, 115, 113, 539, 226, 329, 332)
A3 = c(330, 438, 540, 117, 116, 542, 112, 328, 223)
A4 = c(437, 327, 543, 114, 119, 334, 118, 222, 225)
dim(df)
eligible = df %>% filter(eligible == 1)
eligible = df %>% filter(eligible == 1 & deliveredbyMarch_31_2019 == 1)
sum(!is.na(eligible$validgestatdel))
eligible = df %>% filter(eligible == 1)
sum(!is.na(eligible$validgestatdel))
dim(df)
eligible = df %>% filter(eligible == 1)
table(eligible$StudyGrp)
summary(eligible$StudyGrp)
summary(eligible$StudyGrp2)
table(eligible$StudyGrp2)
df = read.csv(here('data', 'ARMS1_2__3Corrected_4FinalAnalysisV4ConsentedLabelledRecodedOutliersMATERNALFACILITY24Sep2019WMatWtFU.csv'))
df[df == "#NULL!" | df == " " | df == ""] <- NA
eligible = df %>% filter(eligible == 1)
table(eligible$StudyGrp)
eligible = df %>% filter(eligible == 1)
sum(!is.na(eligible$validgestatdel))
eligible = df %>% filter(eligible == 1)
eligible = df %>% filter(eligible == 1 & deliveredbyMarch_31_2019)
analysis = df %>% sum(!is.na(validgestatdel))
eligible = df %>% filter(eligible == 1 & deliveredbyMarch_31_2019)
analysis = eligible %>% sum(!is.na(validgestatdel))
analysis = eligible %>% filter(!is.na(validgestatdel))
table(analysis$StudyGrp)
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
df[df == "#NULL!" | df == " " | df == ""] <- NA
id_arm = read.csv(here('data', 'RW_Study_ID.csv'))
A1 = c(333, 436, 544, 120, 110, 545, 111, 224, 221)
A2 = c(435, 331, 541, 115, 113, 539, 226, 329, 332)
A3 = c(330, 438, 540, 117, 116, 542, 112, 328, 223)
A4 = c(437, 327, 543, 114, 119, 334, 118, 222, 225)
arm1 = df %>% filter(dhc %in% A1 | dhc %in% A2)
arm2 = df %>% filter(dhc %in% A3 | dhc %in% A4)
df1_elig = arm1 %>% filter(eligible == 1)
df2_elig = arm2 %>% filter(eligible == 1)
df = read.csv(here('data', 'ARMS1_2__3Corrected_4FinalAnalysisV4ConsentedLabelledRecodedOutliersMATERNALFACILITY18Sep2019.csv'))
df[df == "#NULL!" | df == " " | df == ""] <- NA
id_arm = read.csv(here('data', 'RW_Study_ID.csv'))
eligible = df %>% filter(eligible == 1)
table(eligible$StudyGrp)
df = read.csv(here('data', 'ARMS1_2__3Corrected_4FinalAnalysisV4ConsentedLabelledRecodedOutliersMATERNALFACILITY16Sep2019.csv'))
df[df == "#NULL!" | df == " " | df == ""] <- NA
eligible = df %>% filter(eligible == 1)
table(eligible$StudyGrp)
summary(eligible$StudyGrp)
sum(7579 + 8259)
