df1 = get_elig(arm2, "analysis")
df2 = get_elig(arm4, "analysis")
df1us = get_us_rates(df1)
df2us = get_us_rates(df2)
source(here('code', "ga_pred", "functions.R"))
df1us = get_us_rates(df1)
df2us = get_us_rates(df2)
df = df1us
dim(df)
ptb_usd2 = as.numeric(df2_usd$ga_del_by_us_date) < 37
ptb_usd2 = as.numeric(df$ga_del_by_us_date) < 37
ptb_usd = (get_n(ptb_usd2))
ptb_us
ptb_usd
(get_n(df$ga_del_by_us_date))
ptb_usd2 = as.numeric(df$ga_del_by_us_date) < 37
ptb_usd = (get_n(ptb_usd2))
ga_usd = (get_n(df$ga_del_by_us_date))
ptb_usd_edd2 = as.numeric(df$ga_del_us) < 37
ptb_usd_edd = (get_n(ptb_usd_edd2))
ga_usd_edd = (get_n(df$ga_del_by_us_date))
names(df)
among_lt_37wk_usd = get_n(df$ga_del_by_us_date[df$ga_del_by_us_date < 37])
among_lt_37wk_edd = get_n(df$ga_del_by_us_edd[df$ga_del_by_us_edd < 37])
among_lt_37wk_edd
among_lt_37wk_usd
summary(df$weight)
lbw = get_n(df$weight < 2500)
lbw
out$ptb_usd = (get_n(ptb_usd2))
out$ga_usd = (get_n(df$ga_del_by_us_date))
ptb_usd_edd2 = as.numeric(df$ga_del_by_us_edd) < 37
out  = NULL
n_usdate = sum(!is.na(df$ga_del_by_us_date))
n_usedd = sum(!is.na(df$ga_del_by_us_edd))
ptb_usd2 = as.numeric(df$ga_del_by_us_date) < 37
out$ptb_usd = (get_n(ptb_usd2))
out$ga_usd = (get_n(df$ga_del_by_us_date))
ptb_usd_edd2 = as.numeric(df$ga_del_by_us_edd) < 37
out$ptb_usd_edd = (get_n(ptb_usd_edd2))
out$ga_usd_edd = (get_n(df$ga_del_by_us_edd))
out$among_lt_37wk_usd = get_n(df$ga_del_by_us_date[df$ga_del_by_us_date < 37])
out$among_lt_37wk_edd = get_n(df$ga_del_by_us_edd[df$ga_del_by_us_edd < 37])
out$lbw_2500 = get_n(df$weight < 2500)
out
do.call(rbind, out)
out2 = output_ptb_rate(df1us)
out4 = output_ptb_rate(df2us)
out2
out4
source('~/Documents/PTBi/rwanda/rw_primary_analysis/code/rw_consort_functions.R')
out2 = output_ptb_rate(df1us)
out4 = output_ptb_rate(df2us)
out2
out3
out4
dim(df1us)
dim(df2us)
source(here('code', "rw_consort_functions.R"))
source(here('code', "ga_pred", "functions.R"))
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
dim(df)
df[df == "#NULL!" | df == " " | df == ""] <- NA
id_arm = read.csv(here('data', 'RW_Study_ID.csv'))
A1 = c(333, 436, 544, 120, 110, 545, 111, 224, 221)
A2 = c(435, 331, 541, 115, 113, 539, 226, 329, 332)
A3 = c(330, 438, 540, 117, 116, 542, 112, 328, 223)
A4 = c(437, 327, 543, 114, 119, 334, 118, 222, 225)
df$study_id_full_new
arm1 = df %>% filter(dhc %in% A1)
arm2 = df %>% filter(dhc %in% A2)
arm3 = df %>% filter(dhc %in% A3)
arm4 = df %>% filter(dhc %in% A4)
df$dhcCons
class(df$dhcCons)
head(df$dhcCons)
head(df$dhc)
class(df$dhc)
df1 = get_elig(arm2, "analysis")
df2 = get_elig(arm4, "analysis")
df1us = get_us_rates(df1)
df2us = get_us_rates(df2)
out2 = output_ptb_rate(df1us)
out4 = output_ptb_rate(df2us)
out2
out4
library(openxlsx)
out = list(out2, out4)
names(out) = c("arm2", "arm4")
write.xlsx(out, file = sprintf("us_among_elig_primary_analysis_%s.xlsx", Sys.Date()), row.names = T)
df = read.csv(here('data', 'ARMS1_2__3Corrected_4FinalAnalysisV4ConsentedLabelledRecodedOutliersMATERNALFACILITY18Sep2019.csv'))
dim(df)
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
dim(df)
df = read.csv(here('data', 'ARMS1_2__3Corrected_4FinalAnalysisV4ConsentedLabelledRecodedOutliersMATERNALFACILITY24Sep2019WMatWtFU.csv'))
dim(df)
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
dfus_date
df$us_date
x = df
us_date =  as.Date(x[, sprintf('us_date')],format= "%m/%d/%Y")
us_date
summary(us_date)
head(df$us_date)
(df$us_date[1:40])
(df$us_date[140:150])
(df$us_date[180:280])
df[df == "#NULL!" | df == " " | df == ""] <- NA
which(is.na(df))
which(is.na(df$us_date))
min(which(!is.na(df$us_date)))
df$us_date[1544:1600]
as.Date(df$us_date[1544:1600], format = "%m/%d/%Y")
df = read.csv(here('data', 'ARMS1_2__3Corrected_4FinalAnalysisV4ConsentedLabelledRecodedOutliersMATERNALFACILITY18Sep2019.csv'))
summary(df$us_rec)
table(df$us_rec)
table(df$us_rec, useNA = "always")
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
table(df$us_rec, useNA = "always")
summary(df$us_date)
sum(is.na(df$us_date))
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
df[df == "#NULL!" | df == " " | df == ""] <- NA
sum(is.na(df$us_date))
df = read.csv(here('data', 'ARMS1_2__3Corrected_4FinalAnalysisV4ConsentedLabelledRecodedOutliersMATERNALFACILITY18Sep2019.csv'))
df[df == "#NULL!" | df == " " | df == ""] <- NA
sum(is.na(df$us_date))
sum(is.na(df$us_adjga))
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
df[df == "#NULL!" | df == " " | df == ""] <- NA
sum(is.na(df$us_adjga))
source(here('code', "rw_consort_functions.R"))
source(here('code', "ga_pred", "functions.R"))
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
df[df == "#NULL!" | df == " " | df == ""] <- NA
id_arm = read.csv(here('data', 'RW_Study_ID.csv'))
sum(is.na(df$us_date))
sum(is.na(df$us_adjga))
A1 = c(333, 436, 544, 120, 110, 545, 111, 224, 221)
A2 = c(435, 331, 541, 115, 113, 539, 226, 329, 332)
A3 = c(330, 438, 540, 117, 116, 542, 112, 328, 223)
A4 = c(437, 327, 543, 114, 119, 334, 118, 222, 225)
arm1 = df %>% filter(dhc %in% A1)
arm2 = df %>% filter(dhc %in% A2)
arm3 = df %>% filter(dhc %in% A3)
arm4 = df %>% filter(dhc %in% A4)
df1 = get_elig(arm2, "analysis")
df2 = get_elig(arm4, "analysis")
df1us = get_us_rates(df1)
source('~/Documents/PTBi/rwanda/rw_primary_analysis/code/rw_consort_functions.R')
df1us = get_us_rates(df1)
df2us = get_us_rates(df2)
dim(df1us)
dim(df2us)
out2 = output_ptb_rate(df1us)
out4 = output_ptb_rate(df2us)
library(openxlsx)
out = list(out2, out4)
names(out) = c("arm2", "arm4")
write.xlsx(out, file = sprintf("us_among_elig_primary_analysis_%s.xlsx", Sys.Date()), row.names = T)
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
library(knitr)
library(here)
library(dplyr)
library(geepack)
library(parsedate)
source(here('code', "rw_consort_functions.R"))
source(here('code', "ga_pred", "functions.R"))
df = read.csv(here('data', 'ARMS1_2__3Corrected_4FinalAnalysisV4ConsentedLabelledRecodedOutliersMATERNALFACILITY18Sep2019.csv'))
df = read.csv(here('data', 'ARMS1_2__3Corrected_4FinalAnalysisV4ConsentedLabelledRecodedOutliersMATERNALFACILITY24Sep2019WMatWtFU.csv'))
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
df[df == "#NULL!" | df == " " | df == ""] <- NA
id_arm = read.csv(here('data', 'RW_Study_ID.csv'))
sum(is.na(df$us_date))
sum(is.na(df$us_adjga))
A1 = c(333, 436, 544, 120, 110, 545, 111, 224, 221)
A2 = c(435, 331, 541, 115, 113, 539, 226, 329, 332)
A3 = c(330, 438, 540, 117, 116, 542, 112, 328, 223)
A4 = c(437, 327, 543, 114, 119, 334, 118, 222, 225)
arm1 = df %>% filter(dhc %in% A1 | dhc %in% A2)
arm2 = df %>% filter(dhc %in% A3 | dhc %in% A4)
arm1 = df %>% filter(dhc %in% A1)
arm2 = df %>% filter(dhc %in% A2)
arm3 = df %>% filter(dhc %in% A3)
arm4 = df %>% filter(dhc %in% A4)
df1 = get_elig(arm2, "analysis")
df2 = get_elig(arm4, "analysis")
summary(df1$us_adjga)
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
df[df == "#NULL!" | df == " " | df == ""] <- NA
id_arm = read.csv(here('data', 'RW_Study_ID.csv'))
source(here('code', "rw_consort_functions.R"))
source(here('code', "ga_pred", "functions.R"))
A1 = c(333, 436, 544, 120, 110, 545, 111, 224, 221)
A2 = c(435, 331, 541, 115, 113, 539, 226, 329, 332)
A3 = c(330, 438, 540, 117, 116, 542, 112, 328, 223)
A4 = c(437, 327, 543, 114, 119, 334, 118, 222, 225)
arm1 = df %>% filter(dhc %in% A1)
arm2 = df %>% filter(dhc %in% A2)
arm3 = df %>% filter(dhc %in% A3)
arm4 = df %>% filter(dhc %in% A4)
source(here('code', "rw_consort_functions.R"))
source(here('code', "ga_pred", "functions.R"))
A1 = c(333, 436, 544, 120, 110, 545, 111, 224, 221)
A2 = c(435, 331, 541, 115, 113, 539, 226, 329, 332)
A3 = c(330, 438, 540, 117, 116, 542, 112, 328, 223)
A4 = c(437, 327, 543, 114, 119, 334, 118, 222, 225)
arm1 = df %>% filter(dhc %in% A1)
arm2 = df %>% filter(dhc %in% A2)
arm3 = df %>% filter(dhc %in% A3)
arm4 = df %>% filter(dhc %in% A4)
df1 = get_elig(arm2, "analysis")
df2 = get_elig(arm4, "analysis")
df1us = get_us_rates(df1)
df2us = get_us_rates(df2)
arm1 = df %>% filter(dhc %in% A1)
arm2 = df %>% filter(dhc %in% A2)
arm3 = df %>% filter(dhc %in% A3)
arm4 = df %>% filter(dhc %in% A4)
df1 = get_elig(arm2, "analysis")
df2 = get_elig(arm4, "analysis")
df1us = get_us_rates(df1)
df2us = get_us_rates(df2)
us_2 = get_us(df2, 2)
us_4 = get_us(df4, 4)
train = make_data(df1us, df2us, "binomial", wk_thresh = 20)
us_2 = get_us(df1, 2)
us_4 = get_us(df2, 4)
train = make_data(df1us, df2us, "binomial", wk_thresh = 20)
train = make_data(us_2, us_4, "binomial", wk_thresh = 22)
make_data
df = read.csv(here('data', 'ARMS1_2__3Corrected_4FinalAnalysisV4ConsentedLabelledRecodedOutliersMATERNALFACILITY24Sep2019WMatWtFU.csv'))
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
df[df == "#NULL!" | df == " " | df == ""] <- NA
id_arm = read.csv(here('data', 'RW_Study_ID.csv'))
source(here('code', "rw_consort_functions.R"))
source(here('code', "ga_pred", "functions.R"))
A1 = c(333, 436, 544, 120, 110, 545, 111, 224, 221)
A2 = c(435, 331, 541, 115, 113, 539, 226, 329, 332)
A3 = c(330, 438, 540, 117, 116, 542, 112, 328, 223)
A4 = c(437, 327, 543, 114, 119, 334, 118, 222, 225)
arm1 = df %>% filter(dhc %in% A1)
arm2 = df %>% filter(dhc %in% A2)
arm3 = df %>% filter(dhc %in% A3)
arm4 = df %>% filter(dhc %in% A4)
df2 = get_elig(arm2, "elig_enroll")
df4 = get_elig(arm4, "elig_enroll")
df1 = get_elig(arm1, "elig_enroll")
df3 = get_elig(arm3, "elig_enroll")
us_1 = get_us(df1, 2)
us_3 = get_us(df3, 4)
new_frame = make_data(us_1, us_3, "binomial", wk_thresh = 20, 1)
us_2 = get_us(df2, 2)
us_4 = get_us(df4, 4)
train = make_data(us_2, us_4, "binomial", wk_thresh = 20)
train = make_data(us_2, us_4, "binomial", wk_thresh = 20, 2)
head(train)
us_2 = get_us(df2, 2)
us_4 = get_us(df4, 4)
train = make_data(us_2, us_4, "binomial", wk_thresh = 22, 2)
summary(train$ga_at_us)
dim(train)
library(dplyr)
train = train %>% filter(ga_at_us >= 6)
summary(train$ga_at_us)
train$Arm = ifelse(train$dhc %in% A2, "stANC", "gANC")
by_arm = split(train, train$Arm)
lapply(by_arm,nrow)
get_us_rates(by_arm$stANC)
df[df == "#NULL!" | df == " " | df == ""] <- NA
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
df[df == "#NULL!" | df == " " | df == ""] <- NA
id_arm = read.csv(here('data', 'RW_Study_ID.csv'))
source(here('code', "rw_consort_functions.R"))
source(here('code', "ga_pred", "functions.R"))
A1 = c(333, 436, 544, 120, 110, 545, 111, 224, 221)
A2 = c(435, 331, 541, 115, 113, 539, 226, 329, 332)
A3 = c(330, 438, 540, 117, 116, 542, 112, 328, 223)
A4 = c(437, 327, 543, 114, 119, 334, 118, 222, 225)
arm1 = df %>% filter(dhc %in% A1)
arm2 = df %>% filter(dhc %in% A2)
arm3 = df %>% filter(dhc %in% A3)
arm4 = df %>% filter(dhc %in% A4)
df2 = get_elig(arm2, "elig_enroll")
df4 = get_elig(arm4, "elig_enroll")
df1 = get_elig(arm1, "elig_enroll")
df3 = get_elig(arm3, "elig_enroll")
us_1 = get_us(df1, 2)
us_3 = get_us(df3, 4)
new_frame = make_data(us_1, us_3, "binomial", wk_thresh = 20, 1)
us_2 = get_us(df2, 2)
us_4 = get_us(df4, 4)
train = make_data(us_2, us_4, "binomial", wk_thresh = 22, 2)
source('~/Documents/PTBi/rwanda/rw_primary_analysis/code/ga_pred/functions.R')
train = make_data(us_2, us_4, "binomial", wk_thresh = 22, 2)
head(train)
head(us_2)
train = make_data(us_2, us_4, "binomial", wk_thresh = 22, 2)
train = train %>% filter(ga_at_us >= 6)
summary(train$ga_at_us)
train$Arm = ifelse(train$dhc %in% A2, "stANC", "gANC")
by_arm = split(train, train$Arm)
get_us_rates(by_arm$stANC)
source('~/Documents/PTBi/rwanda/rw_primary_analysis/code/rw_consort_functions.R')
get_us_rates(by_arm$stANC)
df1us = get_us_rates(by_arm$stANC)
df2us = get_us_rates(by_arm$gANC)
out2 = output_ptb_rate(df1us)
out4 = output_ptb_rate(df2us)
dim(df1us)
dim(df2us)
dim(by_arm$stANC)
dim(by_arm$gANC)
df1us = get_us_rates(by_arm$stANC)
df2us = get_us_rates(by_arm$gANC)
dim(df1us)
df = by_arm$stANC
dim(df)
df$ga_weeks = as.numeric(as.character(df$ga_weeks))
us_2 = us_2[!is.na(us_2$ga_del_by_us_date) | !is.na(us_2$ga_del_by_us_edd), ]
df2 = us_2 %>% filter(ga_del_by_us_edd >= 20 & ga_del_by_us_edd <= 44 |
ga_del_by_us_date >= 20 & ga_del_by_us_date <= 44)
dim(df2)
df = by_arm$stANC
df$ga_weeks = as.numeric(as.character(df$ga_weeks))
us_2 = us_2[!is.na(us_2$ga_del_by_us_date) | !is.na(us_2$ga_del_by_us_edd), ]
df$ga_weeks = as.numeric(as.character(df$ga_weeks))
us_2 = df[!is.na(df$ga_del_by_us_date) | !is.na(df$ga_del_by_us_edd), ]
dim(us_2)
df2 = us_2 %>% filter(ga_del_by_us_edd >= 20 & ga_del_by_us_edd <= 44 |
ga_del_by_us_date >= 20 & ga_del_by_us_date <= 44)
by_arm = split(train, train$Arm)
df1us = get_us_rates(by_arm$stANC)
df2us = get_us_rates(by_arm$gANC)
dim(df1us)
dim(df2us)
dim(by_arm$gANC)
source('~/Documents/PTBi/rwanda/rw_primary_analysis/code/rw_consort_functions.R')
df1us = get_us_rates(by_arm$stANC)
df2us = get_us_rates(by_arm$gANC)
out2 = output_ptb_rate(df1us)
out4 = output_ptb_rate(df2us)
out2
out4
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
df[df == "#NULL!" | df == " " | df == ""] <- NA
id_arm = read.csv(here('data', 'RW_Study_ID.csv'))
source(here('code', "rw_consort_functions.R"))
source(here('code', "ga_pred", "functions.R"))
A1 = c(333, 436, 544, 120, 110, 545, 111, 224, 221)
A2 = c(435, 331, 541, 115, 113, 539, 226, 329, 332)
A3 = c(330, 438, 540, 117, 116, 542, 112, 328, 223)
A4 = c(437, 327, 543, 114, 119, 334, 118, 222, 225)
arm1 = df %>% filter(dhc %in% A1)
arm2 = df %>% filter(dhc %in% A2)
arm3 = df %>% filter(dhc %in% A3)
arm4 = df %>% filter(dhc %in% A4)
df2 = get_elig(arm2, "elig_enroll")
df4 = get_elig(arm4, "elig_enroll")
df1 = get_elig(arm1, "elig_enroll")
df3 = get_elig(arm3, "elig_enroll")
us_1 = get_us(df1, 2)
us_3 = get_us(df3, 4)
us_1$date_del
get_us = function(x, arm) {
study_id = x[, sprintf('study_id_full_new')]
# table(arm2$SID)
# mean(is.na(arm2$study_id_full_new))
# dim(arm4)
# table(df$SIDcorrect)
#study_id_enroll = x[, sprintf('study_id_enroll')]
#study_id_anc1 = x[, sprintf('study_id_anc')]
dhc = x$dhc
m_age_enroll = as.numeric(as.character(x[ ,'m_age']))
m_age_anc1 = as.numeric(x[ ,'m_age_anc'])
x$mother_age_cat = rep(NA, nrow(x))
x$mother_age_cat[x$mother_age >= 12 & x$mother_age < 18] = "12-17"
x$mother_age_cat[x$mother_age >= 18 & x$mother_age <= 35] = "18-35"
x$mother_age_cat[x$mother_age > 35] = "$>$ 35"
#table(df$mother_age_cat)
#as.numeric
m_stature =  as.numeric(x[ , 'ht_und150'])
m_wt = as.numeric(x[ , 'wt_1stvisit'])
#date_del = fix_date(x[, 'date_delivery_mat'])
date_del = as.Date(x[, 'date_delivery_mat'], format= "%d-%b-%y")
date_del = as.Date(x[, 'date_delivery_mat'], format= "%m/%d/%Y")
date_anc1 = as.Date(x[, 'anc1date_anc'], format= "%d-%b-%y")
date_anc1 = as.Date(x[, 'anc1date_anc'], format = "%m/%d/%Y")
days_from_anc1_to_del = (date_del - date_anc1)
wks_from_anc1_to_del = (date_del - date_anc1)/7
## LMP ##
lmp = as.Date(x[, sprintf('lmp_anc')], format= "%m/%d/%Y")
wks_from_lmp_to_del = (date_del - lmp) / 7
ga_at_anc1_by_lmp = (date_anc1 - lmp) / 7
ga_at_deliv_lmp = (ga_at_anc1_by_lmp) + (days_from_anc1_to_del / 7)
## LMP ##
edd = as.Date(x[, sprintf('edd_anc')], format= "%d-%b-%y")
edd = as.Date(x[, sprintf('edd_anc')], format= "%m/%d/%Y")
ga_at_delivery_by_edd_anc1 = (280 + (date_del - edd)) / 7
#Question 3
##GA AT DELIVERY BY GA AT ANC1 ##
ga_anc1_recorded = (x[, sprintf('anc1ga_anc')])
ga_anc1_by_edd = 40 - ((edd - date_anc1)/7)
ga_at_delivery_by_ga_anc1 = ga_anc1_recorded + (days_from_anc1_to_del / 7)
###mother
parity = as.numeric(x[, "parity_anc"])
grav = as.numeric(x[, "gravidity_anc"])
fuel = as.numeric(x[, sprintf("fuel_use")])
enough_food = as.numeric(x[, sprintf("hh_enoughfood")])
ever_no_food = as.numeric(x[, sprintf("hh_evernofood")])
run_out_food = as.numeric(x[, sprintf("hh_runoutfood")])
not_enough_food = as.numeric(x[, sprintf("hh_notenoughfood")])
smoke = as.numeric(x[, sprintf("preg_smoke")])
hh_smoker = as.numeric(x[, sprintf("hh_smoker")])
alc = as.numeric(x[, sprintf("preg_alc")])
###mother
## BABY
sex = x[, 'infant_sex']
muac = as.numeric(x[, sprintf('muac_birth')])
chest_c = as.numeric(x[, sprintf('cc_birth')])
weight = as.numeric(as.character(x[, sprintf('bwt_birth')]))
weight[!is.na(weight) & (weight/10) < 1] <- (weight * 1000)[!is.na(weight) & (weight/10) < 1]
table(weight)
head_cir =  as.numeric(x[ ,sprintf('hc_birth')])
length_b =  as.numeric(x[ ,sprintf('length_birth')])
apgar1 = as.numeric(x[, sprintf('apgar_1mbirth')])
apgar5 = as.numeric(x[, sprintf('apgar_5mbirth')])
## BABY
if (arm == 2 | arm == 4) {
#us_edd = date_cleaning(as.Date(x[, sprintf('edd_us')], format = "%Y-%m-%d"))
us_edd = as.Date(x[, sprintf('edd_us')], format= "%d-%b-%y")
us_edd = as.Date(x[, sprintf('edd_us')], format= "%m/%d/%Y")
ga_at_us = as.numeric(as.character(x[, sprintf('us_adjga')]))
us_date =  as.Date(x[, sprintf('us_date')],format= "%m/%d/%Y")
#us_date =  as.Date(x[, sprintf('us_date')],format= "%d %b %y")
#us_date[140:145]
#x[140:145, 'us_date']
ga_del_by_us_date = ga_at_us + (date_del - us_date)/7
edd_by_us_date = 7*(40 - ga_at_us) + us_date
ga_us_diff = date_del - us_edd
ga_del_by_us_edd = (280 + ga_us_diff) / 7
} else {
ga_del_us = rep(NA, nrow(x))
ga_at_us = rep(NA, nrow(x))
us_date = rep(NA, nrow(x))
}
wks_from_lmp_to_us = (us_date - lmp)/7
wks_from_anc1_to_us = (us_date - date_anc1)/7
wks_from_us_to_del = (date_del - us_date)/7
######## Question 5 ## GA at delivery by FH @ anc1 ###
####
fun_ht_anc1 = as.numeric(as.character(x[, sprintf('fundalht_1stvisit')]))
## check serial fundal height
ga_at_delivery_by_fh_anc1 = fun_ht_anc1 + (days_from_anc1_to_del/7)
## ga weeks delivery recoded
ga_weeks_recorded = x[, sprintf('ga_weeks')]
back_calc_dod_ga_recorded = ga_weeks_recorded - wks_from_anc1_to_del
usrec = x$us_rec
# study_id_anc1,
final = data.frame(dhc, study_id, wks_from_anc1_to_del,
wks_from_anc1_to_us,
wks_from_lmp_to_us, wks_from_lmp_to_del,
wks_from_us_to_del,
lmp, date_anc1, us_date, date_del,
ga_at_anc1_by_lmp, ga_anc1_by_edd, ga_anc1_recorded,
ga_at_us, fun_ht_anc1,
edd, edd_by_us_date, us_edd, ga_del_by_us_date,
ga_at_deliv_lmp, ga_at_delivery_by_ga_anc1,
ga_at_delivery_by_edd_anc1,
ga_at_delivery_by_fh_anc1, ga_del_by_us_edd,
ga_weeks_recorded, usrec, back_calc_dod_ga_recorded)
frame = data.frame(m_age_enroll, m_age_anc1, m_stature, m_wt, parity, grav, fuel,
enough_food, ever_no_food,
run_out_food, not_enough_food, smoke, hh_smoker, alc,
sex, weight, head_cir, length_b, apgar1, apgar5)
frame = data.frame(final, frame)
frame
}
us_1 = get_us(df1, 2)
us_3 = get_us(df3, 4)
us_1$back_calc_dod_ga_recorded
summary(us_1$back_calc_dod_ga_recorded)
summary(as.numeric(us_1$back_calc_dod_ga_recorded))
new_frame = make_data(us_1, us_3, "binomial", wk_thresh = 20, 1)
us_2 = get_us(df2, 2)
us_4 = get_us(df4, 4)
train = make_data(us_2, us_4, "binomial", wk_thresh = 22, 2)
train = train %>% filter(ga_at_us >= 6)
summary(train$ga_at_us)
train$Arm = ifelse(train$dhc %in% A2, "stANC", "gANC")
by_arm = split(train, train$Arm)
df1us = get_us_rates(by_arm$stANC)
df2us = get_us_rates(by_arm$gANC)
out2 = output_ptb_rate(df1us)
out4 = output_ptb_rate(df2us)
out2
us_2 = get_us(df2, 2)
us_4 = get_us(df4, 4)
train = make_data(us_2, us_4, "binomial", wk_thresh = 22, 2)
train = train %>% filter(ga_at_us >= 6)
summary(train$ga_at_us)
train$Arm = ifelse(train$dhc %in% A2, "stANC", "gANC")
by_arm = split(train, train$Arm)
df1us = get_us_rates(by_arm$stANC)
df2us = get_us_rates(by_arm$gANC)
df1us$ga_at_us
source('~/Documents/PTBi/rwanda/rw_primary_analysis/code/rw_consort_functions.R')
out2 = output_ptb_rate(df1us)
out4 = output_ptb_rate(df2us)
out2
out4 = output_ptb_rate(df2us)
out4
