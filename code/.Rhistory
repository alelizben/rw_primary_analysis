summary(clean_bwt)
dim(df)
ga_dup
ga_type
ga_meas = df[, ga_type]
length(ga_meas)
df$lower = ifelse(df$infant_sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
boys_ig$pct3[match(ga_meas, boys_ig$ga)])
df$upper = ifelse(df$infant_sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
boys_ig$pct97[match(ga_meas, boys_ig$ga)])
summary(df$lower)
summary(df$upper)
df$int_grwth =  df$bwt_birth >= df$lower & df$bwt_birth <= df$upper
df$int_grwth =  as.numeric(df$bwt_birth >= df$lower & df$bwt_birth <= df$upper)
summary(df$int_grwth)
length(df$clean_bwt)
summary(clean_bwt)
df$int_grwth =  as.numeric(df$clean_bwt >= df$lower & df$clean_bwt <= df$upper)
summary(df$int_grwth)
make_ig = function(df, ga_type) {
df = analysis
df$clean_bwt = df$bwt_birth / 1000
df$clean_bwt[clean_bwt == 32] <- 3.2
df$clean_bwt[clean_bwt == 27] <- 2.7
summary(clean_bwt)
#ga_weeks = df$validgestatdel
ga_meas = df[, ga_type]
df$lower = ifelse(df$infant_sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
boys_ig$pct3[match(ga_meas, boys_ig$ga)])
df$upper = ifelse(df$infant_sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
boys_ig$pct97[match(ga_meas, boys_ig$ga)])
df$int_grwth =  as.numeric(df$clean_bwt >= df$lower & df$clean_bwt <= df$upper)
return(summary(df$int_grwth))
}
dim(analysis)
make_ig(analysis, 'validgestatdel')
make_ig(analysis[analysis$validgestatdel < 37], 'validgestatdel')
make_ig(analysis[analysis$validgestatdel < 37, ], 'validgestatdel')
make_ig(analysis[analysis$validgestatdel < 37, ]
dim(analysis[analysis$validgestatdel < 37, ])
make_ig(analysis[analysis$validgestatdel < 37, ], 'validgestatdel')
make_ig(analysis, 'validgestatdel')
dim(analysis)
dim(analysis[analysis$validgestatdel < 37, ])
source(here('code', "rw_consort_functions.R"))
source(here('code', "ga_pred", "functions.R"))
girls_ig = read.csv(here('data', 'girls_ig.csv'))
boys_ig = read.csv(here('data', 'boys_ig.csv'))
df = read.csv(here('data', "RwandaFINAL_NEONATALDataSetwUSadded_30OcT2019.csv"))
df[df == "#NULL!" | df == " " | df == ""] <- NA
id_arm = read.csv(here('data', 'RW_Study_ID.csv'))
eligible_only = df %>% filter(eligible == 1 )
eligible = df %>% filter(eligible == 1 & deliveredbyMarch_31_2019 )
analysis = eligible %>% filter(!is.na(validgestatdel))
make_ig = function(df, ga_type) {
df$clean_bwt = df$bwt_birth / 1000
df$clean_bwt[clean_bwt == 32] <- 3.2
df$clean_bwt[clean_bwt == 27] <- 2.7
summary(clean_bwt)
#ga_weeks = df$validgestatdel
ga_meas = df[, ga_type]
df$lower = ifelse(df$infant_sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
boys_ig$pct3[match(ga_meas, boys_ig$ga)])
df$upper = ifelse(df$infant_sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
boys_ig$pct97[match(ga_meas, boys_ig$ga)])
df$int_grwth =  as.numeric(df$clean_bwt >= df$lower & df$clean_bwt <= df$upper)
return(summary(df$int_grwth))
}
dim(analysis)
make_ig(analysis, 'validgestatdel')
make_ig = function(df, ga_type) {
df$clean_bwt = df$bwt_birth / 1000
df$clean_bwt[clean_bwt == 32] <- 3.2
df$clean_bwt[clean_bwt == 27] <- 2.7
#ga_weeks = df$validgestatdel
ga_meas = df[, ga_type]
df$lower = ifelse(df$infant_sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
boys_ig$pct3[match(ga_meas, boys_ig$ga)])
df$upper = ifelse(df$infant_sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
boys_ig$pct97[match(ga_meas, boys_ig$ga)])
df$int_grwth =  as.numeric(df$clean_bwt >= df$lower & df$clean_bwt <= df$upper)
return(summary(df$int_grwth))
}
dim(analysis)
make_ig(analysis, 'validgestatdel')
make_ig = function(df, ga_type) {
df$clean_bwt = df$bwt_birth / 1000
df$clean_bwt[clean_bwt == 32] <- 3.2
df$clean_bwt[clean_bwt == 27] <- 2.7
#ga_weeks = df$validgestatdel
ga_meas = df[, ga_type]
df$lower = ifelse(df$infant_sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
boys_ig$pct3[match(ga_meas, boys_ig$ga)])
df$upper = ifelse(df$infant_sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
boys_ig$pct97[match(ga_meas, boys_ig$ga)])
df$int_grwth =  as.numeric(df$clean_bwt >= df$lower & df$clean_bwt <= df$upper)
return(summary(df$int_grwth))
}
dim(analysis)
make_ig(analysis, 'validgestatdel')
df = analysis
df$clean_bwt = df$bwt_birth / 1000
df$clean_bwt[clean_bwt == 32] <- 3.2
make_ig = function(df, ga_type) {
df$clean_bwt = df$bwt_birth / 1000
df$clean_bwt[df$clean_bwt == 32] <- 3.2
df$clean_bwt[df$clean_bwt == 27] <- 2.7
#ga_weeks = df$validgestatdel
ga_meas = df[, ga_type]
df$lower = ifelse(df$infant_sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
boys_ig$pct3[match(ga_meas, boys_ig$ga)])
df$upper = ifelse(df$infant_sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
boys_ig$pct97[match(ga_meas, boys_ig$ga)])
df$int_grwth =  as.numeric(df$clean_bwt >= df$lower & df$clean_bwt <= df$upper)
return(summary(df$int_grwth))
}
dim(analysis)
make_ig(analysis, 'validgestatdel')
make_ig(analysis[analysis$validgestatdel < 37, ], 'validgestatdel')
dim(analysis[analysis$validgestatdel < 37, ])
make_ig(analysis, 'ga_weeks')
make_ig(analysis[analysis$ga_weeks < 37, ], 'ga_weeks')
here
here()
source(here('code', "rw_consort_functions.R"))
source(here('code', "ga_pred", "functions.R"))
df2 = get_elig(arm2, "elig_enroll")
dim9df
dim(df)
df$StudyArm
df2 = df %>% filter(StudyArm == 2)
df4 = df %>% filter(StudyArm == 4)
df2us = get_us(df2, 2)
df4us = get_us(df4, 4)
summary(df2us)
df4 = df %>% filter(StudyArm == 4)
df2_ga = df2us %>% filter(ga_at_us >=6 & ga_at_us <= 22)
df4_ga = df4us %>% filter(ga_at_us >=6 & ga_at_us <= 22)
train = make_data(df2_ga, df4_ga, "binomial", wk_thresh = 22, 2)
summary(train$ga_at_us)
table(train$studygrp)
names(train)
make_ig(train, "ga_at_del_by_us_date")
dim(train)
make_ig(train, "ga_del_by_us_date")
make_ig(train, "ga_del_by_us_date")
train$ga_del_by_us_date
df = train
dim(df)
head(round(df$ga_del_by_us_date))
ga_meas = round(df[, ga_type])
summary(round(df$ga_del_by_us_date))
boys_ig
dim(train)
ga_type = "ga_del_by_us_date"
ga_meas = round(df[, ga_type])
df = df[ga_meas >= 20 & ga_meas < 43, ]
make_ig = function(df, ga_type) {
ga_meas = round(df[, ga_type])
df = df[ga_meas >= 20 & ga_meas < 43, ]
df$clean_bwt = df$bwt_birth / 1000
df$clean_bwt[df$clean_bwt == 32] <- 3.2
df$clean_bwt[df$clean_bwt == 27] <- 2.7
#ga_weeks = df$validgestatdel
ga_meas = round(df[, ga_type])
df$lower = ifelse(df$infant_sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
boys_ig$pct3[match(ga_meas, boys_ig$ga)])
df$upper = ifelse(df$infant_sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
boys_ig$pct97[match(ga_meas, boys_ig$ga)])
df$int_grwth =  as.numeric(df$clean_bwt >= df$lower & df$clean_bwt <= df$upper)
return(summary(df$int_grwth))
}
make_ig(train, "ga_del_by_us_date")
make_ig = function(df, ga_type) {
ga_meas = round(df[, ga_type])
df = df[ga_meas >= 20 & ga_meas < 43, ]
df$clean_bwt = df$bwt_birth / 1000
df$clean_bwt[df$clean_bwt == 32] <- 3.2
df$clean_bwt[df$clean_bwt == 27] <- 2.7
#ga_weeks = df$validgestatdel
ga_meas = round(df[, ga_type])
df$lower = ifelse(df$infant_sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
boys_ig$pct3[match(ga_meas, boys_ig$ga)])
df$upper = ifelse(df$infant_sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
boys_ig$pct97[match(ga_meas, boys_ig$ga)])
df$int_grwth =  as.numeric(df$clean_bwt >= df$lower & df$clean_bwt <= df$upper)
return(summary(df$int_grwth))
}
dim(analysis)
make_ig(analysis, 'validgestatdel')
make_ig(analysis[analysis$validgestatdel < 37, ], 'validgestatdel')
make_ig(analysis, 'ga_weeks')
make_ig(analysis[analysis$ga_weeks < 37, ], 'ga_weeks')
names(train)
make_ig(train, "ga_del_by_us_date")
ga_type
df = train
ga_meas = round(df[, ga_type])
df = df[ga_meas >= 20 & ga_meas < 43, ]
df$clean_bwt = df$bwt_birth / 1000
summary(df$weight)
make_ig = function(df, ga_type) {
ga_meas = round(df[, ga_type])
df = df[ga_meas >= 20 & ga_meas < 43, ]
#bwt_birth
df$clean_bwt = df$weight / 1000
df$clean_bwt[df$clean_bwt == 32] <- 3.2
df$clean_bwt[df$clean_bwt == 27] <- 2.7
#ga_weeks = df$validgestatdel
ga_meas = round(df[, ga_type])
df$lower = ifelse(df$infant_sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
boys_ig$pct3[match(ga_meas, boys_ig$ga)])
df$upper = ifelse(df$infant_sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
boys_ig$pct97[match(ga_meas, boys_ig$ga)])
df$int_grwth =  as.numeric(df$clean_bwt >= df$lower & df$clean_bwt <= df$upper)
return(summary(df$int_grwth))
}
make_ig(train, "ga_del_by_us_date")
df = train
dim(df)
ga_type
ga_meas = round(df[, ga_type])
df = df[ga_meas >= 20 & ga_meas < 43, ]
df$clean_bwt = df$weight / 1000
df$clean_bwt[df$clean_bwt == 32] <- 3.2
df$clean_bwt[df$clean_bwt == 27] <- 2.7
summary(df$clean_bwt)
df$lower = ifelse(df$infant_sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
boys_ig$pct3[match(ga_meas, boys_ig$ga)])
df$lower = ifelse(df$sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
boys_ig$pct3[match(ga_meas, boys_ig$ga)])
df$upper = ifelse(df$sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
boys_ig$pct97[match(ga_meas, boys_ig$ga)])
df$int_grwth =  as.numeric(df$clean_bwt >= df$lower & df$clean_bwt <= df$upper)
make_ig = function(df, ga_type) {
ga_meas = round(df[, ga_type])
df = df[ga_meas >= 20 & ga_meas < 43, ]
#bwt_birth
df$clean_bwt = df$weight / 1000
df$clean_bwt[df$clean_bwt == 32] <- 3.2
df$clean_bwt[df$clean_bwt == 27] <- 2.7
summary(df$clean_bwt)
#ga_weeks = df$validgestatdel
df$lower = ifelse(df$sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
boys_ig$pct3[match(ga_meas, boys_ig$ga)])
df$upper = ifelse(df$sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
boys_ig$pct97[match(ga_meas, boys_ig$ga)])
# df$lower = ifelse(df$infant_sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
#                   boys_ig$pct3[match(ga_meas, boys_ig$ga)])
# df$upper = ifelse(df$infant_sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
#                   boys_ig$pct97[match(ga_meas, boys_ig$ga)])
df$int_grwth =  as.numeric(df$clean_bwt >= df$lower & df$clean_bwt <= df$upper)
return(summary(df$int_grwth))
}
make_ig(train, "ga_del_by_us_date")
make_ig = function(df, ga_type) {
ga_meas = round(df[, ga_type])
df = df[ga_meas >= 20 & ga_meas < 43, ]
#bwt_birth
df$clean_bwt = df$weight / 1000
df$clean_bwt[df$clean_bwt == 32] <- 3.2
df$clean_bwt[df$clean_bwt == 27] <- 2.7
summary(df$clean_bwt)
#ga_weeks = df$validgestatdel
df$lower = ifelse(df$sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
boys_ig$pct3[match(ga_meas, boys_ig$ga)])
df$upper = ifelse(df$sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
boys_ig$pct97[match(ga_meas, boys_ig$ga)])
# df$lower = ifelse(df$infant_sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
#                   boys_ig$pct3[match(ga_meas, boys_ig$ga)])
# df$upper = ifelse(df$infant_sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
#                   boys_ig$pct97[match(ga_meas, boys_ig$ga)])
df$int_grwth =  as.numeric(df$clean_bwt >= df$lower & df$clean_bwt <= df$upper)
return((df$int_grwth))
}
dim(analysis)
get_n(make_ig(analysis, 'validgestatdel'))
get_n(make_ig(train, "ga_del_by_us_date"))
get_n(make_ig(train[train$ga_del_by_us_date < 37, ], "ga_del_by_us_date"))
us_all = get_n(make_ig(train, "ga_del_by_us_date"))
us_ptb = get_n(make_ig(train[train$ga_del_by_us_date < 37, ], "ga_del_by_us_date"))
dim(analysis)
make_ig = function(df, ga_type) {
ga_meas = round(df[, ga_type])
df = df[ga_meas >= 20 & ga_meas < 43, ]
#bwt_birth
df$clean_bwt = df$bwt_birth / 1000
df$clean_bwt[df$clean_bwt == 32] <- 3.2
df$clean_bwt[df$clean_bwt == 27] <- 2.7
summary(df$clean_bwt)
#ga_weeks = df$validgestatdel
# df$lower = ifelse(df$sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
#                   boys_ig$pct3[match(ga_meas, boys_ig$ga)])
# df$upper = ifelse(df$sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
#                   boys_ig$pct97[match(ga_meas, boys_ig$ga)])
df$lower = ifelse(df$infant_sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
boys_ig$pct3[match(ga_meas, boys_ig$ga)])
df$upper = ifelse(df$infant_sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
boys_ig$pct97[match(ga_meas, boys_ig$ga)])
df$int_grwth =  as.numeric(df$clean_bwt >= df$lower & df$clean_bwt <= df$upper)
return((df$int_grwth))
}
dim(analysis)
get_n(make_ig(analysis, 'validgestatdel'))
get_n(make_ig(analysis[analysis$validgestatdel < 37, ], 'validgestatdel'))
validg_all = get_n(make_ig(analysis, 'validgestatdel'))
validg_ptb = get_n(make_ig(analysis[analysis$validgestatdel < 37, ], 'validgestatdel'))
validg_all = get_n(make_ig(analysis, 'validgestatdel'))
validg_ptb = get_n(make_ig(analysis[analysis$validgestatdel < 37, ], 'validgestatdel'))
ga_wks_all = get_n(make_ig(analysis, 'ga_weeks'))
ga_wks_ptb = get_n(make_ig(analysis[analysis$ga_weeks < 37, ], 'ga_weeks'))
out = rbind(validg_all, validg_ptb, ga_wks_all, ga_wks_ptb, us_all, us_ptb)
out
write.csv(out, file = "intergrowth_ga_neonatal_eligible.csv")
make_ig = function(df, ga_type) {
ga_meas = round(df[, ga_type])
df = df[ga_meas >= 24 & ga_meas < 43, ]
#bwt_birth
df$clean_bwt = df$bwt_birth / 1000
df$clean_bwt[df$clean_bwt == 32] <- 3.2
df$clean_bwt[df$clean_bwt == 27] <- 2.7
summary(df$clean_bwt)
#ga_weeks = df$validgestatdel
# df$lower = ifelse(df$sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
#                   boys_ig$pct3[match(ga_meas, boys_ig$ga)])
# df$upper = ifelse(df$sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
#                   boys_ig$pct97[match(ga_meas, boys_ig$ga)])
df$lower = ifelse(df$infant_sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
boys_ig$pct3[match(ga_meas, boys_ig$ga)])
df$upper = ifelse(df$infant_sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
boys_ig$pct97[match(ga_meas, boys_ig$ga)])
df$int_grwth =  as.numeric(df$clean_bwt >= df$lower & df$clean_bwt <= df$upper)
return((df$int_grwth))
}
dim(analysis)
validg_all = get_n(make_ig(analysis, 'validgestatdel'))
validg_ptb = get_n(make_ig(analysis[analysis$validgestatdel < 37, ], 'validgestatdel'))
ga_wks_all = get_n(make_ig(analysis, 'ga_weeks'))
ga_wks_ptb = get_n(make_ig(analysis[analysis$ga_weeks < 37, ], 'ga_weeks'))
validg_all
validg_ptb
ga_wks_all
ga_wks_ptb
make_ig = function(df, ga_type) {
ga_meas = round(df[, ga_type])
df = df[ga_meas >= 24 & ga_meas <= 43, ]
#bwt_birth
df$clean_bwt = df$bwt_birth / 1000
df$clean_bwt[df$clean_bwt == 32] <- 3.2
df$clean_bwt[df$clean_bwt == 27] <- 2.7
summary(df$clean_bwt)
#ga_weeks = df$validgestatdel
# df$lower = ifelse(df$sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
#                   boys_ig$pct3[match(ga_meas, boys_ig$ga)])
# df$upper = ifelse(df$sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
#                   boys_ig$pct97[match(ga_meas, boys_ig$ga)])
df$lower = ifelse(df$infant_sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
boys_ig$pct3[match(ga_meas, boys_ig$ga)])
df$upper = ifelse(df$infant_sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
boys_ig$pct97[match(ga_meas, boys_ig$ga)])
df$int_grwth =  as.numeric(df$clean_bwt >= df$lower & df$clean_bwt <= df$upper)
return((df$int_grwth))
}
dim(analysis)
validg_all = get_n(make_ig(analysis, 'validgestatdel'))
validg_ptb = get_n(make_ig(analysis[analysis$validgestatdel < 37, ], 'validgestatdel'))
ga_wks_all = get_n(make_ig(analysis, 'ga_weeks'))
ga_wks_ptb = get_n(make_ig(analysis[analysis$ga_weeks < 37, ], 'ga_weeks'))
validg_all
validg_ptb
ga_wks_all
ga_wks_ptb
dim(train)
train$weight
df = train
df$clean_bwt = df$weight / 1000
df$clean_bwt[df$clean_bwt == 32] <- 3.2
df$clean_bwt[df$clean_bwt == 27] <- 2.7
summary(df$clean_bwt)
make_ig = function(df, ga_type) {
ga_meas = round(df[, ga_type])
df = df[ga_meas >= 24 & ga_meas <= 43, ]
if (ga_type == "ga_del_by_us_date") {
df$clean_bwt = df$weight / 1000
df$clean_bwt[df$clean_bwt == 32] <- 3.2
df$clean_bwt[df$clean_bwt == 27] <- 2.7
df$lower = ifelse(df$sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
boys_ig$pct3[match(ga_meas, boys_ig$ga)])
df$upper = ifelse(df$sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
boys_ig$pct97[match(ga_meas, boys_ig$ga)])
} else {
df$clean_bwt = df$bwt_birth / 1000
df$clean_bwt[df$clean_bwt == 32] <- 3.2
df$clean_bwt[df$clean_bwt == 27] <- 2.7
df$lower = ifelse(df$infant_sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
boys_ig$pct3[match(ga_meas, boys_ig$ga)])
df$upper = ifelse(df$infant_sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
boys_ig$pct97[match(ga_meas, boys_ig$ga)])
}
df$int_grwth =  as.numeric(df$clean_bwt >= df$lower & df$clean_bwt <= df$upper)
return((df$int_grwth))
}
dim(analysis)
validg_all = get_n(make_ig(analysis, 'validgestatdel'))
validg_ptb = get_n(make_ig(analysis[analysis$validgestatdel < 37, ], 'validgestatdel'))
ga_wks_all = get_n(make_ig(analysis, 'ga_weeks'))
ga_wks_ptb = get_n(make_ig(analysis[analysis$ga_weeks < 37, ], 'ga_weeks'))
validg_all
validg_ptb
ga_wks_all
ga_wks_ptb
dim(train)
us_all = get_n(make_ig(train, "ga_del_by_us_date"))
us_ptb = get_n(make_ig(train[train$ga_del_by_us_date < 37, ], "ga_del_by_us_date"))
out = rbind(validg_all, validg_ptb, ga_wks_all, ga_wks_ptb, us_all, us_ptb)
out
write.csv(out, file = "intergrowth_ga_neonatal_eligible.csv")
train$ga_del_by_us_date
names(train)
train
summary(train)
View(train)
dim(train)
us_all
ga_type
df = train
ga_meas = round(df[, ga_type])
df = df[ga_meas >= 24 & ga_meas <= 43, ]
if (ga_type == "ga_del_by_us_date") {
df$clean_bwt = df$weight / 1000
df$clean_bwt[df$clean_bwt == 32] <- 3.2
df$clean_bwt[df$clean_bwt == 27] <- 2.7
df$lower = ifelse(df$sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
boys_ig$pct3[match(ga_meas, boys_ig$ga)])
df$upper = ifelse(df$sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
boys_ig$pct97[match(ga_meas, boys_ig$ga)])
} else {
df$clean_bwt = df$bwt_birth / 1000
df$clean_bwt[df$clean_bwt == 32] <- 3.2
df$clean_bwt[df$clean_bwt == 27] <- 2.7
df$lower = ifelse(df$infant_sex == 1, girls_ig$pct3[match(ga_meas, girls_ig$ga)],
boys_ig$pct3[match(ga_meas, boys_ig$ga)])
df$upper = ifelse(df$infant_sex == 0,  girls_ig$pct97[match(ga_meas, girls_ig$ga)],
boys_ig$pct97[match(ga_meas, boys_ig$ga)])
}
table(df$studygrp)
dim(train)
df = train
ga_meas = round(df[, ga_type])
df = df[ga_meas >= 24 & ga_meas <= 43, ]
dim(df)
write.csv(df, file = "US_subset_eligible_date_filter.csv")
dim(analysis)
dim(df)
df = analysis
df2 = df %>% filter(StudyArm == 2)
df4 = df %>% filter(StudyArm == 4)
df2us = get_us(df2, 2)
df4us = get_us(df4, 4)
df2_ga = df2us %>% filter(ga_at_us >=6 & ga_at_us <= 22)
df4_ga = df4us %>% filter(ga_at_us >=6 & ga_at_us <= 22)
us_2 = df2us
us_4 = df4us
out2 = us_2
out4 = us_4
dim(out2)
dim(out4)
us_2 = us_2[!is.na(us_2$ga_del_by_us_date) | !is.na(us_2$ga_del_by_us_edd), ]
us_4 = us_4[!is.na(us_4$ga_del_by_us_date) | !is.na(us_4$ga_del_by_us_edd), ]
out2 = us_2
out4 = us_4
dim(out2)
dim(out4)
vars = rbind(out2, out4)
table(vars$m_age_anc1)
table(vars$ga_at_anc1_by_lmp < 0)
wks22 = vars
wk_thresh
wk_thresh = 22
wks22 = wks22[wks22$ga_at_us <= wk_thresh, ]
dim(wks22)
train$ga_weeks_recorded = as.numeric(train$ga_weeks_recorded)
train$ga_del_by_us_date = as.numeric(train$ga_del_by_us_date)
train$ga_del_by_us_edd = as.numeric(train$ga_del_by_us_edd)
train$mother_age_cat = rep(NA, nrow(train))
train$mother_age_cat[train$m_age_anc1 >= 12 & train$m_age_anc1 < 18] = "12-17"
train$mother_age_cat[train$m_age_anc1 >= 18 & train$m_age_anc1 <= 35] = "18-35"
train$mother_age_cat[train$m_age_anc1 > 35] = "$>$ 35"
dim(train)
keep = train[get_diff(train, 24),]
dim(keep)
train = keep %>% filter( (ga_del_by_us_date >= 24 & ga_del_by_us_date <= 45) |
(ga_del_by_us_edd >= 24 & ga_del_by_us_edd <= 45))
dim(train)
df2_ga = df2us %>% filter(ga_at_us >=6 & ga_at_us <= 22)
df4_ga = df4us %>% filter(ga_at_us >=6 & ga_at_us <= 22)
train = make_data(df2_ga, df4_ga, "binomial", wk_thresh = 22, 2)
dim(train)
df = analysis
df2 = df %>% filter(StudyArm == 2)
df4 = df %>% filter(StudyArm == 4)
df2us = get_us(df2, 2)
df4us = get_us(df4, 4)
df2_ga = df2us %>% filter(ga_at_us >=6 & ga_at_us <= 22)
df4_ga = df4us %>% filter(ga_at_us >=6 & ga_at_us <= 22)
train = make_data(df2_ga, df4_ga, "binomial", wk_thresh = 22, 2)
df = train
ga_meas = round(df[, ga_type])
df = df[ga_meas >= 24 & ga_meas <= 43, ]
dim(train
)
train = keep %>% filter( (ga_del_by_us_date >= 24 & ga_del_by_us_date <= 45))
