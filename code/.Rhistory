m_age_anc1 = as.numeric(x[ ,'m_age_anc'])
x$mother_age_cat = rep(NA, nrow(x))
x$mother_age_cat[x$mother_age >= 12 & x$mother_age < 18] = "12-17"
x$mother_age_cat[x$mother_age >= 18 & x$mother_age <= 35] = "18-35"
x$mother_age_cat[x$mother_age > 35] = "$>$ 35"
#table(df$mother_age_cat)
#as.numeric
m_stature =  as.numeric(x[ , 'ht_und150'])
m_wt = as.numeric(x[ , 'wt_1stvisit'])
#date_del = fix_date(x[, 'date_delivery_mat'])
date_del = as.Date(x[, 'date_delivery_mat'], format= "%d-%b-%y")
date_del = as.Date(x[, 'date_delivery_mat'], format= "%m/%d/%Y")
date_anc1 = as.Date(x[, 'anc1date_anc'], format= "%d-%b-%y")
date_anc1 = as.Date(x[, 'anc1date_anc'], format = "%m/%d/%Y")
days_from_anc1_to_del = (date_del - date_anc1)
wks_from_anc1_to_del = (date_del - date_anc1)/7
## LMP ##
lmp = as.Date(x[, sprintf('lmp_anc')], format= "%m/%d/%Y")
wks_from_lmp_to_del = (date_del - lmp) / 7
ga_at_anc1_by_lmp = (date_anc1 - lmp) / 7
ga_at_deliv_lmp = (ga_at_anc1_by_lmp) + (days_from_anc1_to_del / 7)
## LMP ##
edd = as.Date(x[, sprintf('edd_anc')], format= "%d-%b-%y")
edd = as.Date(x[, sprintf('edd_anc')], format= "%m/%d/%Y")
ga_at_delivery_by_edd_anc1 = (280 + (date_del - edd)) / 7
#Question 3
##GA AT DELIVERY BY GA AT ANC1 ##
ga_anc1_recorded = (x[, sprintf('anc1ga_anc')])
ga_anc1_by_edd = 40 - ((edd - date_anc1)/7)
ga_at_delivery_by_ga_anc1 = ga_anc1_recorded + (days_from_anc1_to_del / 7)
###mother
parity = as.numeric(x[, "parity_anc"])
grav = as.numeric(x[, "gravidity_anc"])
fuel = as.numeric(x[, sprintf("fuel_use")])
enough_food = as.numeric(x[, sprintf("hh_enoughfood")])
ever_no_food = as.numeric(x[, sprintf("hh_evernofood")])
run_out_food = as.numeric(x[, sprintf("hh_runoutfood")])
not_enough_food = as.numeric(x[, sprintf("hh_notenoughfood")])
smoke = as.numeric(x[, sprintf("preg_smoke")])
hh_smoker = as.numeric(x[, sprintf("hh_smoker")])
alc = as.numeric(x[, sprintf("preg_alc")])
ubud = x$ubudehe_cat
###mother
## BABY
sex = x[, 'infant_sex']
muac = as.numeric(x[, sprintf('muac_birth')])
chest_c = as.numeric(x[, sprintf('cc_birth')])
weight = as.numeric(as.character(x[, sprintf('bwt_birth')]))
weight[!is.na(weight) & (weight/10) < 1] <- (weight * 1000)[!is.na(weight) & (weight/10) < 1]
table(weight)
head_cir =  as.numeric(x[ ,sprintf('hc_birth')])
length_b =  as.numeric(x[ ,sprintf('length_birth')])
apgar1 = as.numeric(x[, sprintf('apgar_1mbirth')])
apgar5 = as.numeric(x[, sprintf('apgar_5mbirth')])
## BABY
if (arm == 2 | arm == 4) {
#us_edd = date_cleaning(as.Date(x[, sprintf('edd_us')], format = "%Y-%m-%d"))
us_edd = as.Date(x[, sprintf('edd_us')], format= "%d-%b-%y")
us_edd = as.Date(x[, sprintf('edd_us')], format= "%m/%d/%Y")
ga_at_us = as.numeric(as.character(x[, sprintf('us_adjga')]))
us_date =  as.Date(x[, sprintf('us_date')],format= "%m/%d/%Y")
#us_date =  as.Date(x[, sprintf('us_date')],format= "%d %b %y")
#us_date[140:145]
#x[140:145, 'us_date']
ga_del_by_us_date = ga_at_us + (date_del - us_date)/7
edd_by_us_date = 7*(40 - ga_at_us) + us_date
ga_us_diff = date_del - us_edd
ga_del_by_us_edd = (280 + ga_us_diff) / 7
wks_from_lmp_to_us = (us_date - lmp)/7
wks_from_anc1_to_us = (us_date - date_anc1)/7
wks_from_us_to_del = (date_del - us_date)/7
final = data.frame(wks_from_anc1_to_us,
wks_from_lmp_to_us,
wks_from_us_to_del,
us_date,
ga_at_us, edd_by_us_date, us_edd, ga_del_by_us_date,
ga_del_by_us_edd)
} else {
wks_from_lmp_to_us = NA
wks_from_anc1_to_us = NA
wks_from_us_to_del = NA
us_date = NA
ga_at_us = rep(NA, nrow(x))
edd_by_us_date =  rep(NA, nrow(x))
us_edd = rep(NA, nrow(x))
ga_del_by_us_date = rep(NA, nrow(x))
ga_del_by_us_edd = rep(NA, nrow(x))
final = data.frame(wks_from_anc1_to_us,
wks_from_lmp_to_us,
wks_from_us_to_del,
us_date,
ga_at_us, edd_by_us_date, us_edd, ga_del_by_us_date,
ga_del_by_us_edd)
}
######## Question 5 ## GA at delivery by FH @ anc1 ###
####
fun_ht_anc1 = as.numeric(as.character(x[, sprintf('fundalht_1stvisit')]))
## check serial fundal height
ga_at_delivery_by_fh_anc1 = fun_ht_anc1 + (days_from_anc1_to_del/7)
## ga weeks delivery recoded
ga_weeks_recorded = x[, sprintf('ga_weeks')]
back_calc_dod_ga_recorded = ga_weeks_recorded - wks_from_anc1_to_del
usrec = x$us_rec
# study_id_anc1,
risk_factors = x %>% select(obhx_preterm, obhx_lbw, obhx_abortion, obhx_sb, obhx_28d_death)
risk_factors[is.na(risk_factors)] <- 0
sapply(risk_factors, table)
frame = data.frame(study_id, studygrp, studyarm, risk_factors, dhc, m_age_enroll, m_age_anc1, m_stature, m_wt, parity, grav, fuel,
enough_food, ever_no_food,
run_out_food, not_enough_food, smoke, hh_smoker, alc, ubud,
lmp, date_anc1,
usrec, ga_at_anc1_by_lmp, ga_anc1_by_edd, ga_anc1_recorded,
fun_ht_anc1, edd,
wks_from_anc1_to_del, wks_from_lmp_to_del, date_del,
val_ga,
ga_at_deliv_lmp, ga_at_delivery_by_ga_anc1,
ga_at_delivery_by_edd_anc1,
ga_at_delivery_by_fh_anc1,
ga_weeks_recorded,
back_calc_dod_ga_recorded,
sex, weight, head_cir, length_b, apgar1, apgar5)
frame = data.frame(frame, final)
frame
}
no_us = get_us(rbind(arm1, arm3), 1)
us_arm = get_us(rbind(arm2, arm4), 4)
all_arms = rbind(no_us, us_arm)
by_study_grp = (split(all_arms, all_arms$studygrp))
by_arm = lapply(split(us_arm, us_arm$studyarm), function(j) j %>% filter(ga_at_us >= 6 & ga_at_us <= 22))
lapply(by_study_grp, nrow)
lapply(by_arm, nrow)
get_us_stats = function(df) {
out = c()
out$ga_at_birth_mat_register = df$val_ga
out$ga_at_birth_early_us = ifelse(!is.na(df$ga_del_by_us_date), df$ga_del_by_us_date, NA)
out$ga_at_birth_by_ga_anc1 = df$ga_at_delivery_by_ga_anc1
out$ptb_by_mat_reg = df$ga_weeks < 37
out$ptb_by_early_us = ifelse(!is.na(df$ga_del_by_us_date), df$ga_del_by_us_date < 37, NA)
out$ga_anc1 = df$anc1ga_anc
out$ga_anc1_early_US = ifelse(!is.na(df$wks_from_anc1_to_us), (df$ga_at_us - df$wks_from_anc1_to_us)/7, NA)
out$ga_anc1_back_calc_deliv = df$back_calc_dod_ga_recorded
out = lapply(out, get_n)
out = do.call(rbind, out)
out
}
lapply(by_study_grp, nrow)
lapply(by_arm, get_us_stats)
lapply(by_study_grp, get_us_stats)
get_us_stats = function(df) {
out = c()
out$ga_at_birth_mat_register = df$val_ga
out$ga_at_birth_early_us = ifelse(!is.na(df$ga_del_by_us_date) &
df$ga_at_us >=6 & df$ga_at_us <= 22, df$ga_del_by_us_date, NA)
out$ga_at_birth_by_ga_anc1 = df$ga_at_delivery_by_ga_anc1
out$ptb_by_mat_reg = df$ga_weeks < 37
out$ptb_by_early_us = ifelse(!is.na(df$ga_del_by_us_date) &
df$ga_at_us >=6 & df$ga_at_us <= 22, df$ga_del_by_us_date < 37, NA)
out$ga_anc1 = df$anc1ga_anc
out$ga_anc1_early_US = ifelse(!is.na(df$wks_from_anc1_to_us) &
df$ga_at_us >=6 & df$ga_at_us <= 22, (df$ga_at_us - df$wks_from_anc1_to_us)/7, NA)
out$ga_anc1_back_calc_deliv = df$back_calc_dod_ga_recorded
out = lapply(out, get_n)
out = do.call(rbind, out)
out
}
lapply(by_study_grp, nrow)
lapply(by_arm, get_us_stats)
lapply(by_study_grp, get_us_stats)
lapply(by_arm, nrow)
lapply(by_arm, get_us_stats)
lapply(by_study_grp, get_us_stats)
do.call(lapply(by_arm, get_us_stats), rbind)
do.call(rbind, lapply(by_arm, get_us_stats))
do.call(cbind, lapply(by_arm, get_us_stats))
do.call(cbind, lapply(by_arm, get_us_stats))
do.call(cbind, lapply(by_study_grp, get_us_stats))
by_arm_res = do.call(cbind, lapply(by_arm, get_us_stats))
study_grp_res = do.call(cbind, lapply(by_study_grp, get_us_stats))
write.csv(study_grp_res, file = "us_table1_supplement.csv")
get_us_stats = function(df) {
out = c()
out$ga_at_birth_mat_register = df$val_ga
out$ga_at_birth_early_us = ifelse(!is.na(df$ga_del_by_us_date) &
df$ga_at_us >=6 & df$ga_at_us <= 22, df$ga_del_by_us_date, NA)
out$ga_at_birth_by_ga_anc1 = df$ga_at_delivery_by_ga_anc1
out$ptb_by_mat_reg = df$ga_weeks < 37
out$ptb_by_early_us = ifelse(!is.na(df$ga_del_by_us_date) &
df$ga_at_us >=6 & df$ga_at_us <= 22, df$ga_del_by_us_date < 37, NA)
out$ga_anc1_register = df$anc1ga_anc
out$ga_anc1_early_US = ifelse(!is.na(df$wks_from_anc1_to_us) &
df$ga_at_us >=6 & df$ga_at_us <= 22, (df$ga_at_us - df$wks_from_anc1_to_us)/7, NA)
out$ga_anc1_back_calc_deliv = df$back_calc_dod_ga_recorded
out = lapply(out, get_n)
out = do.call(rbind, out)
out
}
lapply(by_study_grp, nrow)
by_arm_res = do.call(cbind, lapply(by_arm, get_us_stats))
study_grp_res = do.call(cbind, lapply(by_study_grp, get_us_stats))
by_arm_res
get_us_stats = function(df) {
out = c()
out$ga_at_birth_mat_register = df$val_ga
out$ga_at_birth_early_us = ifelse(!is.na(df$ga_del_by_us_date) &
df$ga_at_us >=6 & df$ga_at_us <= 22, df$ga_del_by_us_date, NA)
out$ga_at_birth_by_ga_anc1 = df$ga_at_delivery_by_ga_anc1
out$ptb_by_mat_reg = df$ga_weeks < 37
out$ptb_by_early_us = ifelse(!is.na(df$ga_del_by_us_date) &
df$ga_at_us >=6 & df$ga_at_us <= 22, df$ga_del_by_us_date < 37, NA)
out$ga_anc1_register = df$anc1ga_anc
out$ga_anc1_early_US = ifelse(!is.na(df$wks_from_anc1_to_us) &
df$ga_at_us >=6 & df$ga_at_us <= 22, (df$ga_at_us - df$wks_from_anc1_to_us)/7, NA)
out$ga_anc1_back_calc_deliv = df$back_calc_dod_ga_recorded
out = lapply(out, get_n)
out = do.call(rbind, out)
out
}
lapply(by_study_grp, nrow)
lapply(by_arm, get_us_stats)
get_us_stats = function(df) {
out = c()
out$ga_at_birth_mat_register = df$val_ga
out$ga_at_birth_early_us = ifelse(!is.na(df$ga_del_by_us_date) &
df$ga_at_us >=6 & df$ga_at_us <= 22, df$ga_del_by_us_date, NA)
out$ga_at_birth_by_ga_anc1 = df$ga_at_delivery_by_ga_anc1
out$ptb_by_mat_reg = df$ga_weeks < 37
out$ptb_by_early_us = ifelse(!is.na(df$ga_del_by_us_date) &
df$ga_at_us >=6 & df$ga_at_us <= 22, df$ga_del_by_us_date < 37, NA)
out$ga_anc1_register = df$ga_anc1_recorded
out$ga_anc1_early_US = ifelse(!is.na(df$wks_from_anc1_to_us) &
df$ga_at_us >=6 & df$ga_at_us <= 22, (df$ga_at_us - df$wks_from_anc1_to_us)/7, NA)
out$ga_anc1_back_calc_deliv = df$back_calc_dod_ga_recorded
out = lapply(out, get_n)
out = do.call(rbind, out)
out
}
lapply(by_study_grp, nrow)
by_arm_res = do.call(cbind, lapply(by_arm, get_us_stats))
study_grp_res = do.call(cbind, lapply(by_study_grp, get_us_stats))
write.csv(cbind(study_grp_res, by_arm_res), file = "us_table1_supplement.csv")
get_us_stats = function(df) {
out = c()
out$ga_at_birth_mat_register = df$val_ga
out$ga_at_birth_early_us = ifelse(!is.na(df$ga_del_by_us_date) &
df$ga_at_us >=6 & df$ga_at_us <= 22, df$ga_del_by_us_date, NA)
out$ga_at_birth_by_ga_anc1 = df$ga_at_delivery_by_ga_anc1
out$ptb_by_mat_reg = df$ga_weeks < 37
out$ptb_by_early_us = ifelse(!is.na(df$ga_del_by_us_date) &
df$ga_at_us >=6 & df$ga_at_us <= 22, df$ga_del_by_us_date < 37, NA)
out$ga_anc1_register = df$ga_anc1_recorded
out$ga_anc1_early_US = ifelse(!is.na(df$wks_from_anc1_to_us) &
df$ga_at_us >=6 & df$ga_at_us <= 22, (df$ga_at_us - df$wks_from_anc1_to_us), NA)
out$ga_anc1_back_calc_deliv = df$back_calc_dod_ga_recorded
out = lapply(out, get_n)
out = do.call(rbind, out)
out
}
lapply(by_study_grp, nrow)
by_arm_res = do.call(cbind, lapply(by_arm, get_us_stats))
study_grp_res = do.call(cbind, lapply(by_study_grp, get_us_stats))
write.csv(cbind(study_grp_res, by_arm_res), file = "us_table1_supplement.csv")
lapply(by_arm, nrow)
get_us_stats = function(df) {
out = c()
out$ga_at_birth_mat_register = df$val_ga
out$ga_at_birth_early_us = ifelse(!is.na(df$ga_del_by_us_date) &
df$ga_at_us >=6 & df$ga_at_us <= 22, df$ga_del_by_us_date, NA)
out$ga_at_birth_by_ga_anc1 = df$ga_at_delivery_by_ga_anc1
out$ptb_by_mat_reg = df$ga_weeks < 37
out$ptb_by_early_us = ifelse(!is.na(df$ga_del_by_us_date) &
df$ga_at_us >=6 & df$ga_at_us <= 22, df$ga_del_by_us_date < 37, NA)
out$ga_anc1_register = df$ga_anc1_recorded
out$ga_anc1_early_US = ifelse(!is.na(df$ga_at_us) &
df$ga_at_us >=6 & df$ga_at_us <= 22, (df$ga_at_us - df$wks_from_anc1_to_us), NA)
out$ga_anc1_back_calc_deliv = df$back_calc_dod_ga_recorded
out = lapply(out, get_n)
out = do.call(rbind, out)
out
}
lapply(by_study_grp, nrow)
by_arm_res = do.call(cbind, lapply(by_arm, get_us_stats))
study_grp_res = do.call(cbind, lapply(by_study_grp, get_us_stats))
write.csv(cbind(study_grp_res, by_arm_res), file = "us_table1_supplement.csv")
library(knitr)
library(here)
library(dplyr)
library(geepack)
library(parsedate)
library(ggplot2)
opts_chunk$set(fig.width=12, fig.height=4, fig.path='RnwFigs/',
warning=FALSE, message=FALSE, tidy=FALSE)
options(width=60)
set.seed(53079239)
if(!require("qtl")) install.packages("qtl", repos="http://cran.us.r-project.org")
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
df[df == "#NULL!" | df == " " | df == ""] <- NA
id_arm = read.csv(here('data', 'RW_Study_ID.csv'))
table(df$ubudehe_cat)
table(x$obhx_preterm, x$hx_ptdlvry)
summary(x$enroll_obhx___1)
source(here('code', "rw_consort_functions.R"))
source(here('code', "ga_pred", "functions.R"))
A1 = c(333, 436, 544, 120, 110, 545, 111, 224, 221)
A2 = c(435, 331, 541, 115, 113, 539, 226, 329, 332)
A3 = c(330, 438, 540, 117, 116, 542, 112, 328, 223)
A4 = c(437, 327, 543, 114, 119, 334, 118, 222, 225)
arm1 = df %>% filter(dhc %in% A1)
arm2 = df %>% filter(dhc %in% A2)
arm3 = df %>% filter(dhc %in% A3)
arm4 = df %>% filter(dhc %in% A4)
eligible = df %>% filter(eligible == 1 & deliveredbyMarch_31_2019 )
analysis = eligible %>% filter(!is.na(validgestatdel))
arm1 = analysis %>% filter(dhc %in% A1)
arm2 = analysis %>% filter(dhc %in% A2)
arm3 = analysis %>% filter(dhc %in% A3)
arm4 = analysis %>% filter(dhc %in% A4)
no_us = get_us(rbind(arm1, arm3), 1)
us_arm = get_us(rbind(arm2, arm4), 4)
df2 = get_elig(arm2, "elig_enroll")
df4 = get_elig(arm4, "elig_enroll")
df1 = get_elig(arm1, "elig_enroll")
df3 = get_elig(arm3, "elig_enroll")
sum(nrow(df1), nrow(df2))
sum(nrow(df3), nrow(df4))
dim(analysis)
table(analysis$StudyGrp)
df2 = get_elig(arm2, "elig_enroll")
df4 = get_elig(arm4, "elig_enroll")
df1 = get_elig(arm1, "elig_enroll")
df3 = get_elig(arm3, "elig_enroll")
df1us = get_us(df1, 1)
df2us = get_us(df2, 2)
df3us = get_us(df3, 3)
df4us = get_us(df4, 4)
df1_ga = df1us %>% filter(back_calc_dod_ga_recorded >= 6 & back_calc_dod_ga_recorded <= 22)
df3_ga = df3us %>% filter(back_calc_dod_ga_recorded >= 6 & back_calc_dod_ga_recorded <= 22)
train = make_data(df2us_ga, df4us_ga, "binomial", wk_thresh = 22, 2)
df2_ga = df2us %>% filter(ga_at_us >=6 & df$ga_at_us <= 22)
df4_ga = df4us %>% filter(ga_at_us >=6 & df$ga_at_us <= 22)
df1us = get_us(df1, 1)
df2us = get_us(df2, 2)
df3us = get_us(df3, 3)
df4us = get_us(df4, 4)
df1_ga = df1us %>% filter(back_calc_dod_ga_recorded >= 6 & back_calc_dod_ga_recorded <= 22)
df3_ga = df3us %>% filter(back_calc_dod_ga_recorded >= 6 & back_calc_dod_ga_recorded <= 22)
df2_ga = df2us %>% filter(ga_at_us >=6 & df$ga_at_us <= 22)
df4_ga = df4us %>% filter(ga_at_us >=6 & df$ga_at_us <= 22)
df2 = get_elig(arm2, "elig_enroll")
df4 = get_elig(arm4, "elig_enroll")
df1 = get_elig(arm1, "elig_enroll")
df3 = get_elig(arm3, "elig_enroll")
df1us = get_us(df1, 1)
df2us = get_us(df2, 2)
df3us = get_us(df3, 3)
df4us = get_us(df4, 4)
df1_ga = df1us %>% filter(back_calc_dod_ga_recorded >= 6 & back_calc_dod_ga_recorded <= 22)
df3_ga = df3us %>% filter(back_calc_dod_ga_recorded >= 6 & back_calc_dod_ga_recorded <= 22)
df2_ga = df2us %>% filter(ga_at_us >=6 & df$ga_at_us <= 22)
df4_ga = df4us %>% filter(ga_at_us >=6 & df$ga_at_us <= 22)
dim(df2)
dim(df4)
df2us = get_us(df2, 2)
df4us = get_us(df4, 4)
dim(df2us)
df2us$ga_at_us
df2_ga = df2us %>% filter(ga_at_us >=6 & ga_at_us <= 22)
df4_ga = df4us %>% filter(ga_at_us >=6 & $ga_at_us <= 22)
df4_ga = df4us %>% filter(ga_at_us >=6 & ga_at_us <= 22)
train = make_data(df2us_ga, df4us_ga, "binomial", wk_thresh = 22, 2)
train = make_data(df2_ga, df4_ga, "binomial", wk_thresh = 22, 2)
summary(train$ga_at_us)
train$Arm = ifelse(train$dhc %in% A2, "US_stANC", "US_gANC")
table(train$Arm)
by_arm = split(train, train$Arm)
by_arm = lapply(by_arm, output_ptb_rate)
by_arm
library(knitr)
library(here)
library(dplyr)
library(geepack)
library(parsedate)
opts_chunk$set(fig.width=12, fig.height=4, fig.path='RnwFigs/',
warning=FALSE, message=FALSE, tidy=FALSE)
options(width=60)
set.seed(53079239)
if(!require("qtl")) install.packages("qtl", repos="http://cran.us.r-project.org")
source(here('code', "rw_consort_functions.R"))
source(here('code', "ga_pred", "functions.R"))
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
df[df == "#NULL!" | df == " " | df == ""] <- NA
id_arm = read.csv(here('data', 'RW_Study_ID.csv'))
eligible_only = df %>% filter(eligible == 1 )
eligible = df %>% filter(eligible == 1 & deliveredbyMarch_31_2019 )
analysis = eligible %>% filter(!is.na(validgestatdel))
summary(eligible$ga_weeks)
analys = eligible %>% filter(!is.na(ga_weeks))
summary(analys$bwt_birth)
hist(analys$bwt_birth)
hist(analys$bwt_birth, 20)
hist(analys$bwt_birth, 40)
hist(analys$bwt_birth, 60)
hist(analys$bwt_birth, 80)
hist(analys$bwt_birth, 90)
hist(analys$bwt_birth, 100)
den(analys$bwt_birth)
dens(analys$bwt_birth)
density(analys$bwt_birth)
density(analys$bwt_birth[!is.na(analys$bwt_birth)])
den = density(analys$bwt_birth[!is.na(analys$bwt_birth)])
plot(den)
den = density(analys$bwt_birth[!is.na(analys$bwt_birth)], n = 20)
plot(den)
den = density(analys$bwt_birth[!is.na(analys$bwt_birth)], n = 500)
den = density(analys$bwt_birth[!is.na(analys$bwt_birth)], n = 500)
plot(den)
den = density(analys$bwt_birth[!is.na(analys$bwt_birth) & analys$bwt_birth <= 5000], n = 500, xlim)
den = density(analys$bwt_birth[!is.na(analys$bwt_birth) & analys$bwt_birth <= 5000], n = 500)
plot(den)
analysis = eligible %>% filter(!is.na(validgestatdel))
summary(analysis$bwt_birth)
bw = split(analysis, analysis$bwt_birth)
lapply(bw, function(j) sum(is.na(j$bwt_birth)))
bw = split(analysis, analysis$StudyGrp)
lapply(bw, function(j) sum(is.na(j$bwt_birth)))
lapply(bw, function(j) summary((j$bwt_birth)))
library(here)
girls_ig = read.csv(here('data', 'girls_ig.csv'))
library(here)
source(here('code', "rw_consort_functions.R"))
source(here('code', "ga_pred", "functions.R"))
girls_ig = read.csv(here('data', 'girls_ig.csv'))
boys_ig = read.csv(here('data', 'boys_ig.csv'))
df = read.csv(here('data', "MatCohort_USadded_30Oct19_BP.csv"))
df[df == "#NULL!" | df == " " | df == ""] <- NA
id_arm = read.csv(here('data', 'RW_Study_ID.csv'))
pair1 = c(1, 10, 8, 3, 13, 4, 2, 17, 5)
pair2 = c(9, 11, 14, 16, 6, 15, 12, 18, 7)
p2 = rep(NA, 18)
p2[pair1] = pair2
p2[pair2] = pair1
df$Pair_US = p2[df$Pair]
quad = strsplit(paste(df$Pair, df$Pair_US), " ")
quad = paste(lapply(quad, function(j) sort(as.numeric(j))))
df$quad = quad
df$Pair_USUPT = paste(df$quad, df$StudyGrp)
eligible_only = df %>% filter(eligible == 1 )
eligible = df %>% filter(eligible == 1 & deliveredbyMarch_31_2019 )
analys = eligible %>% filter(!is.na(ga_weeks))
summary(analys$bwt_birth)
analysis = eligible %>% filter(!is.na(validgestatdel))
den = density(analys$bwt_birth[!is.na(analys$bwt_birth) & analys$bwt_birth <= 5000], n = 500)
plot(den)
library(knitr)
library(here)
library(dplyr)
library(geepack)
library(parsedate)
opts_chunk$set(fig.width=12, fig.height=4, fig.path='RnwFigs/',
warning=FALSE, message=FALSE, tidy=FALSE)
options(width=60)
set.seed(53079239)
if(!require("qtl")) install.packages("qtl", repos="http://cran.us.r-project.org")
A1 = c(333, 436, 544, 120, 110, 545, 111, 224, 221)
A2 = c(435, 331, 541, 115, 113, 539, 226, 329, 332)
A3 = c(330, 438, 540, 117, 116, 542, 112, 328, 223)
A4 = c(437, 327, 543, 114, 119, 334, 118, 222, 225)
make_analysis_data = function(df, usupt) {
arm1 = df %>% filter(dhc %in% A1 | dhc %in% A3)
arm2 = df %>% filter(dhc %in% A2 | dhc %in% A4)
df_all = data.frame(rbind(arm1, arm2))
df_all$id = as.numeric(df_all$dhc)
df_all$weight = 1/nrow(df_all)
df_all$Y = df_all$validgestatdel
df_all$anc1ga_anc
table(df_all$NumberANCs)
df_all$at_least_4 = df_all$NumberANCs >= 4
df_all$at_least_3 = df_all$NumberANCs >= 3
df_all$ga_lt_16 = df_all$anc1ga_anc <= 16
table(df_all$ga_lt_16)
if (usupt) {
df_all$A <- df_all$InUSUPTarm
df_all$Pair = df_all$Pair_USUPT
} else {
df_all$A <- df_all$StudyGrp
}
data = subset(df_all, select = c(validgestatdel, at_least_4, ga_lt_16, at_least_3, anc1ga_anc,
weight, A, id, Pair, Pair_USUPT, quad, InUSUPTarm, StudyGrp, StudyArm))
table(data$A, data$Pair)
return(data)
}
summary_by_arm = function(df) {
out = lapply(split(df, df$A), function(j) sapply(j[, 2:5], get_n))
out
}
library(openxlsx)
dim(analysis)
eligible_only = df %>% filter(eligible == 1 )
eligible = df %>% filter(eligible == 1 & deliveredbyMarch_31_2019 )
analysis = eligible %>% filter(!is.na(validgestatdel))
dim(analysis)
df = anlysis
df = anlaysis
clean_bwt = df$bwt_birth
ga_weeks = df$validgestatdel
df$validgestatdel
table(df$infant_sex)
df_g = df %>% filter(infant_sex == 1)
df_b = df %>% filter(infant_sex == 1)
df$validgestatdel[match(df$validgestatdel, boys_ig$ga)]
match(df$validgestatdel, boys_ig$ga)
df$validgestatdel[1:5]
match(boys_ig$ga, df$validgestatdel)
